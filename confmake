#!/usr/bin/perl

($input,$config)=@ARGV;

$input='Makefile.in' if $input eq '';
$config='conf/migdal.conf' if $config eq '';
$status=0;

print "# Created automatically from Makefile.in\n";
open IN,$input;
while(<IN>)
     {
     unless(/^#\s@\(#\)\s\$Id[^\$]*\$/)
           {
           print;
	   next;
	   }
     open CONF,$config;
     while(<CONF>)
	  {
	  next if /\?>/ || /<\?/;
	  s/#.*$//;
	  next if /^\s*$/;
	  my ($name,$value)=/^\$(\w+)=(.*);\s*$/;
	  if($name eq '' || $value eq '')
	    {
	    print STDERR "confmake: Incorrect config line $.: $_";
	    $status=1;
	    }
	  else
	    {
	    print "$name=$value\n";
	    }
	  }
     close CONF;
     }
close IN;
exit $status;
