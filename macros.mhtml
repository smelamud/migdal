<< @(#) $Id$ >>

<< Constants  & Globals >>
<macro name='decconst'>
 <macro name='%name'>
  <require name='%file'>
 </macro>
</macro>

<decconst name='conf' file='conf/migdal.conf'>
<decconst name='errors' file='lib/errors.php'>
<decconst name='grps' file='lib/grps.php'>
<decconst name='image_placements' file='lib/stotext-images.php'>
<decconst name='sorts' file='lib/sort.php'>
<decconst name='text_formats' file='lib/text.php'>

<< Iterators >>
<macro name='deciter' defaults="name='%name'">
 <macro name='iterate_%macro' defaults="%defaults">
  <require name='%file'>
  <iterate name='%name' class='%class' %@params>
 </macro>
</macro>

<macro name='iterate_http' defaults="method=get remove=''">
 <require name='lib/uri.php'>
 <iterate name='%name' class='HTTPVarsIterator'
          arg1='$$HTTP_%^{method}_VARS' arg2='%remove'>
</macro>

<macro name='hiddenget'>
 <zone>
  <array vals='%remove'>
  <iterate_http remove='$*'>
  <for><input type=hidden name='$.Name' value='$.Value'></for>
 </zone>
</macro>

<deciter macro='array' class='ArrayIterator' file='lib/array.php'
         params='values' defaults="values='$*'">
<deciter macro='chat' class='ChatMessageListIterator' file='lib/chat.php'
         params='limit' defaults='limit=20'>
<deciter macro='complainlist' class='ComplainListIterator'
         file='lib/complains.php' params='limit,offset'
	 defaults='limit=20 offset=0'>
<deciter macro='complain_actionlist' class='ComplainActionListIterator'
         file='lib/complainactions.php' params='type'>
<deciter macro='complain_scriptlist' class='ComplainScriptListIterator'
         file='lib/complainscripts.php' params='ident'>
<deciter macro='complain_types' class='ComplainTypeListIterator'
         file='lib/complaintypes.php'>
<deciter macro='confirm_instant_messagelist'
         class='ConfirmInstantMessageListIterator' file='lib/instants.php'>
<deciter macro='forum_answerlist' class='ForumAnswerListIterator'
         file='lib/forums.php' params='up,limit,offset'
	 defaults='limit=20 offset=0'>
<deciter macro='grps' class='GrpIterator' file='lib/grputils.php'>
<deciter macro='imageset' class='ImageSetIterator' file='lib/images.php'
         params='imageset'>
<deciter macro='instant_messagelist' class='InstantMessageListIterator'
         file='lib/instants.php'>
<deciter macro='menu' class='MenuIterator' file='lib/menu.php' params='ident'>
<deciter macro='paragraphs' class='ParagraphIterator' file='lib/paragraphs.php'
         params='format,body'>
<deciter macro='picturelist' class='PictureListIterator' file='lib/postings.php'
         params='grp,topic,recursive,rows,cols,offset,personal,sort'
         defaults="grp='$grp' topic=-1 recursive='*false' rows=4 cols=5 offset=0 personal=0 sort='*SORT_SENT'">
<deciter macro='posting_paragraphs' class='PostingParagraphIterator'
         file='lib/postings.php' params='posting'>
<deciter macro='postinglist' class='PostingListIterator' file='lib/postings.php'
         params='grp,topic,recursive,limit,offset,personal,sort,withanswers'
         defaults="grp='$grp' topic=-1 recursive='*false' limit=10 offset=0 personal=0 sort='*SORT_SENT' withanswers='*false'">
<deciter macro='received_instant_messagelist'
         class='ReceivedInstantMessageListIterator' file='lib/instants.php'>
<deciter macro='sortarray' class='SortedArrayIterator' file='lib/array.php'
         params='values' defaults="values='$*'">
<deciter macro='styles' class='StyleNamesIterator' file='lib/style.php'>
<deciter macro='topiclist' class='TopicListIterator' file='lib/topics.php'
         params='grp,up,withpostings,withanswers'
         defaults="up=0 withpostings='*false' withanswers='*false'">
<deciter macro='topicnames' class='TopicNamesIterator' file='lib/topics.php'
         params='grp'>
<deciter macro='userlist' class='UserListIterator' file='lib/users.php'>

<< Calls >>
<macro name='deccall' defaults="name='%name'">
 <macro name='%macro' defaults="%defaults">
  <require name='%file'>
  <call name='%name' func='%func' %@params>
 </macro>
</macro>

<deccall macro='decstyle' func='declareStyle' file='lib/style.php'
         params='ident,desc'>

<deccall macro='complain_action_obj' func='getComplainActionById'
         file='lib/complainactions.php' params='id' defaults='name=act'>
<deccall macro='complain_obj' func='getComplainById' file='lib/complains.php'
         params='id,ident,link' defaults='name=complain ident=normal link=0'>
<deccall macro='complain_full' func='getFullComplainById'
         file='lib/complains.php' params='id,ident'
	 defaults='name=complain ident=normal'>
<deccall macro='complain_type_obj' func='getComplainTypeById'
         file='lib/complaintypes.php' params='id' defaults='name=type'>
<deccall macro='forum_answer_obj' func='getForumAnswerById'
         file='lib/forums.php' params='id,up' defaults='name=answer up=0'>
<deccall macro='forum_answer_author' func='getForumAnswerAuthorBySent'
         file='lib/forums.php' params='up,sent' defaults='name=answer up=0'>
<deccall macro='forum_answer_full' func='getFullForumAnswerById'
         file='lib/forums.php' params='id' defaults='name=answer'>
<deccall macro='image_obj' func='getImageById' file='lib/images.php' params='id'
         defaults='name=image id=0'>
<deccall macro='image_name' func='getImageNameBySet' file='lib/images.php'
         params='set' defaults='name=image'>
<deccall macro='image_tag' func='getImageTagById' file='lib/images.php'
         params='id,align' defaults="align=''">
<deccall macro='image_link' func='getImageEnlargeLinkById' file='lib/images.php'
         params='id'>
<deccall macro='menu_obj' func='getMenuItemById' file='lib/menu.php'
         params='id' defaults='name=menu id=0'>
<deccall macro='plural' func='getPlural' file='lib/utils.php'
         params='value,words' defaults="words='$*'">
<deccall macro='posting_obj' func='getPostingById' file='lib/postings.php'
         params='id,grp,topic' defaults='name=message grp=*GRP_ALL topic=0'>
<deccall macro='posting_full' func='getFullPostingById' file='lib/postings.php'
         params='id,grp' defaults='name=message grp=*GRP_ALL'>
<deccall macro='stotext_image_obj' func='getStotextImageByParagraph'
         file='lib/stotext-images.php' params='id,par' defaults='name=image'>
<deccall macro='time' func='time'>
<deccall macro='topic_obj' func='getTopicById' file='lib/topics.php'
         params='id,up' defaults='id="$topic_id" up=0'>
<deccall macro='topic_name' func='getTopicNameById' file='lib/topics.php'
         params='id' defaults='name=topic id="$topic_id"'>
<deccall macro='user_obj' func='getUserById' file='lib/users.php' params='id'>

<macro name='image_tag_put' defaults="align=''">
 <zone><image_tag id='%id' align=%align>$,</zone>
</macro>

<macro name='image_linked_tag' defaults="enlarge=true align=''">
 <zone>
  <if what='%enlarge'>
   <image_link id='%id'>$,<image_tag_put id='%id' align=%align></a>
  <else>
   <image_tag_put id='%id' align=%align>
  </if>
 </zone>
</macro>

<macro name='reload'>
 <require name='lib/utils.php'>
 <zone>
  <call func='reloadParameter' arg1='%why' arg2='%var' arg3='%value'>
 </zone>
</macro>

<< GRP >>
<macro name='grpdata' defaults="name=g grp='$grp' ignore=0">
 <require name='lib/grputils.php'>
 <obj name='%name' class='GrpData' arg1='%grp' arg2='%ignore'>
</macro>

<macro name='grp' defaults="name=g grp='$grp' ignore=0">
 <header>
  <require name='lib/grps.php'>
  <grpdata name='%name' grp='%grp' ignore='%ignore'>
 </header>
</macro>

<macro name='decgrpmesgs' defaults="grp='%grp'">
 <macro name='%name' defaults="grp='$grp'">
  <zone>
   <array vals='%vals'>
   <grpword name='%name' grp='%grp'>
  </zone>
 </macro>
</macro>

<deccall macro='grpword' func='getGrpWord' file='lib/grps.php'
         params='grp,words' defaults="grp='$grp' words='$*'">
<deccall macro='grpplural' func='getGrpPlural' file='lib/grps.php'
         params='value,grp,words' defaults="grp='$grp' words='$*'">

<< Conditionals >>
<macro name='endif'>
 <macro name='%name'>
  </if>
 </macro>
</macro>

<macro name='ifzero'>
 <if what='%what==0'>
</macro>
<endif name='/ifzero'>

<macro name='ifnzero'>
 <if what='%what!=0'>
</macro>
<endif name='/ifnzero'>

<macro name='isedit'>
 <if what='$%name.isEditable'>
</macro>
<endif name='/isedit'>

<macro name='noedit'>
 <if what='!$%name.isEditable'>
</macro>
<endif name='/noedit'>

<macro name='isfirst'>
 <if what='$%name.isFirst'>
</macro>
<endif name='/isfirst'>

<macro name='notfirst'>
 <if what='!$%name.isFirst'>
</macro>
<endif name='/notfirst'>

<macro name='islast'>
 <if what='$%name.isLast'>
</macro>
<endif name='/islast'>

<macro name='notlast'>
 <if what='!$%name.isLast'>
</macro>
<endif name='/notlast'>

<< Permissions >>
<macro name='logged'>
 <if what='$$userId>0'>
</macro>
<endif name='/logged'>

<macro name='notlogged'>
 <if what='$$userId<0'>
</macro>
<endif name='/notlogged'>

<macro name='admin_users'>
 <if what='$$userAdminUsers'>
</macro>
<endif name='/admin_users'>

<macro name='admin_topics'>
 <if what='$$userAdminTopics'>
</macro>
<endif name='/admin_topics'>

<macro name='admin_menu'>
 <if what='$$userAdminMenu'>
</macro>
<endif name='/admin_menu'>

<macro name='admin_complain_answers'>
 <if what='$$userAdminComplainAnswers'>
</macro>
<endif name='/admin_complain_answers'>

<macro name='moderator'>
 <if what='$$userModerator'>
</macro>
<endif name='/moderator'>

<macro name='judge'>
 <if what='$$userJudge'>
</macro>
<endif name='/judge'>

<< Typecasts >>
<macro name='int'>
 <header>
  <settype name='%name' type='integer' method='%method'>
 </header>
</macro>

<macro name='string'>
 <header><zone>
  <call name='%name' func='addslashes' arg1='$%name'>
 </zone></header>
</macro>

<< HTML shortcuts >>
<macro name='tdspan' defaults='span=0'>
 <ifzero what='%span'><td><else><td colspan=%span></ifzero>
</macro>

<macro name='/tdspan'>
 </td>
</macro>

<macro name='hidden'>
 <input type=hidden name='%name' value='%value'>
</macro>

<macro name='edit' defaults='size=40 maxlength=250'>
 <input type=text name='%name' value='%value' size=%size maxlength=%maxlength>
</macro>

<macro name='edit_line'>
 <tr>
  <td>%title </td>
  <tdspan span=%span>
   <edit name='%name' value='%value' size=%size maxlength=%maxlength>
  </td>
 </tr>
</macro>

<macro name='editor_line' defaults='span=0 rows=10'>
 <tr><tdspan span=%span>%title</tdspan></tr>
 <tr><tdspan span=%span>
  <textarea name='%name' rows=%rows cols=50 wrap='virtual'>%body</textarea>
 </tdspan></tr>
</macro>

<macro name='checkbox' defaults='value=0'>
 <ifzero what='%value'>
  <input type=checkbox name='%name' value=1> %title
 <else>
  <input type=checkbox name='%name' value=1 checked> %title
 </ifzero>
</macro>

<macro name='checkbox_line'>
 <tr><tdspan span=%span>
  <checkbox name='%name' value='%value' title='%title'>
 </td></tr>
</macro>

<macro name='radio' defaults='peervalue="-1"'>
 <if what='%value==%peervalue'>
  <option value='%value' selected>%title
 <else>
  <option value='%value'>%title
 </if>
</macro>

<macro name='select_portion'>
<select name='%name'>
 <array val1='%vals' val2='%value'>
 <iterate_sortarray>
 <for>
  <radio value='$.' peervalue='%value' title='$.'>
 </for>
</select>
</macro>
