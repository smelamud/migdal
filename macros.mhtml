<< @(#) $Id$ >>

<< Constants  & Globals >>
<macro name='grps'>
 <require name='lib/grps.php'>
</macro>

<macro name='conf'>
 <require name='conf/migdal.conf'>
</macro>

<macro name='errors'>
 <require name='lib/errors.php'>
</macro>

<macro name='image_placements'>
 <require name='lib/stotext-images.php'>
</macro>

<macro name='text_formats'>
 <require name='lib/text.php'>
</macro>

<< GRP >>
<macro name='grpdata' defaults="name=g grp='$grp' ignore=0">
 <require name='lib/grputils.php'>
 <obj name='%name' class='GrpData' arg1='%grp' arg2='%ignore'>
</macro>

<macro name='grp' defaults='name=g ignore=0'>
 <header>
  <require name='lib/grps.php'>
  <grpdata name='%name' ignore='%ignore'>
  <reload why='$%name.Invalid' var='grp' value='*GRP_FORUMS'>
 </header>
</macro>

<< Iterators >>
<macro name='iterate_array' defaults="values='$*'">
 <require name='lib/array.php'>
 <iterate name='%name' class='ArrayIterator' arg1='%values'>
</macro>

<macro name='iterate_chat' defaults='limit=20'>
 <require name='lib/chat.php'>
 <iterate name='%name' class='ChatMessageListIterator' arg1='%limit'>
</macro>

<macro name='iterate_complainlist' defaults='limit=20 offset=0'>
 <require name='lib/complains.php'>
 <iterate name='%name' class='ComplainListIterator' arg1='%limit'
          arg2='%offset'>
</macro>

<macro name='iterate_complain_actionlist'>
 <require name='lib/complainactions.php'>
 <iterate name='%name' class='ComplainActionListIterator' arg1='%type'>
</macro>

<macro name='iterate_complain_scriptlist'>
 <require name='lib/complainscripts.php'>
 <iterate name='%name' class='ComplainScriptListIterator' arg1='%ident'>
</macro>

<macro name='iterate_complain_types'>
 <require name='lib/complaintypes.php'>
 <iterate name='%name' class='ComplainTypeListIterator'>
</macro>

<macro name='iterate_forum_answerlist'>
 <require name='lib/forums.php'>
 <iterate name='%name' class='ForumAnswerListIterator'
          arg1='%up' arg2='%limit' arg3='%offset'>
</macro>

<macro name='iterate_http' defaults="method=get remove=''">
 <require name='lib/uri.php'>
 <iterate name='%name' class='HTTPVarsIterator'
          arg1='$$HTTP_%^{method}_VARS' arg2='%remove'>
</macro>

<macro name='hiddenget'>
 <zone>
  <array vals='%remove'>
  <iterate_http remove='$*'>
  <for><input type=hidden name='$.Name' value='$.Value'></for>
 </zone>
</macro>

<macro name='iterate_imageset'>
 <require name='lib/images.php'>
 <iterate name='%name' class='ImageSetIterator' arg1='%imageset'>
</macro>

<macro name='iterate_menu'>
 <require name='lib/menu.php'>
 <iterate name='%name' class='MenuIterator' arg1='%ident'>
</macro>

<macro name='iterate_months'>
 <require name='lib/months.php'>
 <iterate name='%name' class='MonthsIterator'>
</macro>

<macro name='iterate_paragraphs'>
 <require name='lib/paragraphs.php'>
 <iterate name='%name' class='ParagraphIterator' arg1='%format' arg2='%body'>
</macro>

<macro name='iterate_posting_paragraphs'>
 <require name='lib/postings.php'>
 <iterate name='%name' class='PostingParagraphIterator' arg1='%posting'>
</macro>

<macro name='iterate_postinglist'
       defaults="grp='$grp' topic=-1 limit=10 offset=0 personal=0">
 <require name='lib/postings.php'>
 <iterate name='%name' class='PostingListIterator'
          arg1='%grp' arg2='%topic' arg3='%limit' arg4='%offset' arg5='%personal'>
</macro>

<macro name='iterate_sortarray' defaults="values='$*'">
 <require name='lib/array.php'>
 <iterate name='%name' class='SortedArrayIterator' arg1='%values'>
</macro>

<macro name='iterate_topiclist' defaults="up=0">
 <require name='lib/topics.php'>
 <iterate name='%name' class='TopicListIterator' arg1='%grp' arg2='%up'>
</macro>

<macro name='iterate_topicnames'>
 <require name='lib/topics.php'>
 <iterate name='%name' class='TopicNamesIterator' arg1='%grp'>
</macro>

<macro name='iterate_userlist'>
 <require name='lib/users.php'>
 <iterate name='%name' class='UserListIterator'>
</macro>

<< Calls >>
<macro name='complain_action_obj' defaults='name=act'>
 <require name='lib/complainactions.php'>
 <call name='%name' func='getComplainActionById' arg1='%id'>
</macro>

<macro name='complain_obj' defaults='name=complain ident=normal link=0'>
 <require name='lib/complains.php'>
 <call name='%name' func='getComplainById' arg1='%id' arg2='%ident'
       arg3='%link'>
</macro>

<macro name='complain_full' defaults='name=complain ident=normal'>
 <require name='lib/complains.php'>
 <call name='%name' func='getFullComplainById' arg1='%id' arg2='%ident'>
</macro>

<macro name='complain_type_obj' defaults='name=type'>
 <require name='lib/complaintypes.php'>
 <call name='%name' func='getComplainTypeById' arg1='%id'>
</macro>

<macro name='forum_answer_obj' defaults='name=answer up=0'>
 <require name='lib/forums.php'>
 <call name='%name' func='getForumAnswerById' arg1='%id' arg2='%up'>
</macro>

<macro name='forum_answer_full' defaults='name=answer'>
 <require name='lib/forums.php'>
 <call name='%name' func='getFullForumAnswerById' arg1='%id'>
</macro>

<macro name='image_obj' defaults='name=image id=0'>
 <require name='lib/images.php'>
 <call name='%name' func='getImageById' arg1='%id'>
</macro>

<macro name='image_name' defaults='name=image'>
 <require name='lib/images.php'>
 <call name='%name' func='getImageNameBySet' arg1='%set'>
</macro>

<macro name='image_tag' defaults="align=''">
 <require name='lib/images.php'>
 <call name='%name' func='getImageTagById' arg1='%id' arg2='%align'>
</macro>

<macro name='image_tag_put' defaults="align=''">
 <zone><image_tag id='%id' align=%align>$,</zone>
</macro>

<macro name='image_link'>
 <require name='lib/images.php'>
 <call name='%name' func='getImageEnlargeLinkById' arg1='%id'>
</macro>

<macro name='image_linked_tag' defaults="enlarge=true align=''">
 <zone>
  <if what='%enlarge'>
   <image_link id='%id'>$,<image_tag_put id='%id' align=%align></a>
  <else>
   <image_tag_put id='%id' align=%align>
  </if>
 </zone>
</macro>

<macro name='menu_obj' defaults='name=menu id=0'>
 <require name='lib/menu.php'>
 <call name='%name' func='getMenuItemById' arg1='%id'>
</macro>

<macro name='stotext_image_obj' defaults='name=image'>
 <require name='lib/stotext-images.php'>
 <call name='%name' func='getStotextImageByParagraph' arg1='%id' arg2='%par'>
</macro>

<macro name='posting_obj' defaults='name=message grp=*GRP_ALL topic=0'>
 <require name='lib/postings.php'>
 <call name='%name' func='getPostingById' arg1='%id' arg2='%grp' arg3='%topic'>
</macro>

<macro name='posting_full' defaults='name=message grp=*GRP_ALL'>
 <require name='lib/postings.php'>
 <call name='%name' func='getFullPostingById' arg1='%id' arg2='%grp'>
</macro>

<macro name='reload'>
 <require name='lib/utils.php'>
 <zone>
  <call func='reloadParameter' arg1='%why' arg2='%var' arg3='%value'>
 </zone>
</macro>

<macro name='time'>
 <call name='%name' func='time'>
</macro>

<macro name='topic_obj' defaults='id="$topic_id" up=0'>
 <require name='lib/topics.php'>
 <call name='%name' func='getTopicById' arg1='%id' arg2='%up'>
</macro>

<macro name='topic_name' defaults='name=topic id="$topic_id"'>
 <require name='lib/topics.php'>
 <call name='%name' func='getTopicNameById' arg1='%id'>
</macro>

<macro name='user_obj'>
 <require name='lib/users.php'>
 <call name='%name' func='getUserById' arg1='%id'>
</macro>

<< Conditionals >>
<macro name='ifzero'>
 <if what='%what==0'>
</macro>

<macro name='/ifzero'>
 </if>
</macro>

<macro name='ifnzero'>
 <if what='%what!=0'>
</macro>

<macro name='/ifnzero'>
 </if>
</macro>

<macro name='isedit'>
 <if what='$%name.isEditable'>
</macro>

<macro name='/isedit'>
 </if>
</macro>

<macro name='noedit'>
 <if what='!$%name.isEditable'>
</macro>

<macro name='/noedit'>
 </if>
</macro>

<macro name='isfirst'>
 <if what='$%name.isFirst'>
</macro>

<macro name='/isfirst'>
 </if>
</macro>

<macro name='notfirst'>
 <if what='!$%name.isFirst'>
</macro>

<macro name='/notfirst'>
 </if>
</macro>

<macro name='islast'>
 <if what='$%name.isLast'>
</macro>

<macro name='/islast'>
 </if>
</macro>

<macro name='notlast'>
 <if what='!$%name.isLast'>
</macro>

<macro name='/notlast'>
 </if>
</macro>

<< Permissions >>
<macro name='logged'>
 <if what='$$userId>0'>
</macro>

<macro name='/logged'>
 </if>
</macro>

<macro name='notlogged'>
 <if what='$$userId<0'>
</macro>

<macro name='/notlogged'>
 </if>
</macro>

<macro name='admin_users'>
 <if what='$$userAdminUsers'>
</macro>

<macro name='/admin_users'>
 </if>
</macro>

<macro name='admin_topics'>
 <if what='$$userAdminTopics'>
</macro>

<macro name='/admin_topics'>
 </if>
</macro>

<macro name='admin_menu'>
 <if what='$$userAdminMenu'>
</macro>

<macro name='/admin_menu'>
 </if>
</macro>

<macro name='admin_complain_answers'>
 <if what='$$userAdminComplainAnswers'>
</macro>

<macro name='/admin_complain_answers'>
 </if>
</macro>

<macro name='moderator'>
 <if what='$$userModerator'>
</macro>

<macro name='/moderator'>
 </if>
</macro>

<macro name='judge'>
 <if what='$$userJudge'>
</macro>

<macro name='/judge'>
 </if>
</macro>

<< Typecasts >>
<macro name='int'>
 <header>
  <settype name='%name' type='integer' method='%method'>
 </header>
</macro>

<< HTML shortcuts >>
<macro name='tdspan' defaults='span=0'>
 <ifzero what='%span'><td><else><td colspan=%span></ifzero>
</macro>

<macro name='/tdspan'>
 </td>
</macro>

<macro name='edit' defaults='size=40 maxlength=250'>
 <input type=text name='%name' value='%value' size=%size maxlength=%maxlength>
</macro>

<macro name='edit_line'>
 <tr>
  <td>%title </td>
  <tdspan span=%span>
   <edit name='%name' value='%value' size=%size maxlength=%maxlength>
  </td>
 </tr>
</macro>

<macro name='editor_line' defaults='span=0 rows=10'>
 <tr><tdspan span=%span>%title</tdspan></tr>
 <tr><tdspan span=%span>
  <textarea name='%name' rows=%rows cols=50 wrap='virtual'>%body</textarea>
 </tdspan></tr>
</macro>

<macro name='checkbox' defaults='value=0'>
 <ifzero what='%value'>
  <input type=checkbox name='%name' value=1> %title
 <else>
  <input type=checkbox name='%name' value=1 checked> %title
 </ifzero>
</macro>

<macro name='checkbox_line'>
 <tr><tdspan span=%span>
  <checkbox name='%name' value='%value' title='%title'>
 </td></tr>
</macro>

<macro name='radio' defaults='peervalue="-1"'>
 <if what='%value==%peervalue'>
  <option value='%value' selected>%title
 <else>
  <option value='%value'>%title
 </if>
</macro>

<macro name='select_portion'>
<select name='%name'>
 <array val1='%vals' val2='%value'>
 <iterate_sortarray>
 <for>
  <radio value='$.' peervalue='%value' title='$.'>
 </for>
</select>
</macro>
