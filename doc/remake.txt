Что необходимо менять при пересмотре кода
=========================================

1. idByIdent() и identById() не требуется таблица (entries по дефолту) и
поменялся порядок параметров.
2. В начале страниц и в начале action'ов требуется объявление всех параметров
(проверяется с register_globals = off). В том числе okdir, faildir и edittag.
3. Есть radio_button для <input type='radio'>.
4. Внутренний формат уже не HTML, а такой же, как исходник. Требуется
подстановка $=var для вставки в HTML простых строк, в которых могут быть
неэкранированные спецсимволы. Это не требуется, где есть методы *HTML() которые
конвертируют из внутреннего представления в уже подготовленный для HTML формат.
5. getWorldVars(), getAdminVars(), collectVars(), getNormal() упразднены.
6. PHP3 умер. Рассчитываем на PHP 4.1. Используем parent::, superglobals.
8. Функции, генерирующие SQL, сами обрабатывают свои параметры через
addslashes(), используя промежуточные переменные $*S (вообще почаще пользуемся
промежуточными переменными вместо конкатенации). Внешняя обработка не
требуется. 
9. Все переменные запроса хранятся в $Args. В скриптах заменяем $args на $Args.
10. Пользуемся __FUNCTION__ для получения имени функции. Имя метода получаем
как раньше.
11. *id-параметры превратились в _i-параметры и расшифровываются автоматически
в post*()-методах.
12. Метод Object::store() выносится как функция storeObject(). Аналогично и
другие методы, работающие с базой. Аргумент в storeObject() должен
передаваться по ссылке (!), чтобы записывать туда id новосозданного объекта.
13. HTMLSmth() переименовывается в SmthHTML().
14. is_int() иногда нужно заменить на is_numeric().
16. Перестраиваем таблицы вместо border на комбинацию двух таблиц.
17. $`postings:kes` -> $`post.kes`.
18. Избавляемся от селекторов-вложений в CSS и переходим на имена классов типа
.form-cell, если возможно.
19. Избавляемся от иерархий классов в постингах и т.п.
20. Функции, работающие с базой, убираем из actions/ и кладем в lib/.
22. Ставить <label> везде, где только можно.
23. Не проводить операции с тенями на entries, не являющихся постингами. Не
предусматривать это ни в итераторах, ни в store().
24. Преобразование кодировок и форматов убрать из setup() и проводить либо
непосредственно при проверке параметров, либо при сохранении.
25. Объявлять переменную $METHOD там, где используется get_method() для
получения имени метода для sql().
26. Обработать parser'ы, чтобы генерируемый ими код также удовлетворял этим
требованиям.
27. Все (проверить!) ссылки должны быть переведены на ЧПУ.
28. <subtitle> теперь принимает непосредственный параметр, по умолчанию -
    заголовок страницы.
29. sqlDate() и sqlNow() при вставке времени в запрос.
30. Групповые GRP_ теперь не маски, а строки. Массивы, им соотвествующие,
берутся функцией grpArray() из lib/grps.php.
31. Убедиться, что все модифицирующие запросы реплицируются, включая операции
с картинками. Убедиться, что в команде репликации track указывается всегда
правильное имя таблицы.
32. У PostingListIterator/getPostingById поменялся набор SELECT_*;
33. Все ссылки должны быть абсолютными.
34. parent:: должен использоваться в конструкторах всех итераторов. Проверить
все случаи использования /$this->[A-Z]/
35. Проверить на отсутствие <pagetitle> и <topictitle>.
38. В навигаторе тем на каждом уровне должен присутствовать <upper_level> со
ссылкой наверх. Сейчас он вставляется прямо в соответствующий <topic_*>.
39. Проверить правильность значения аргумента showshadows postinglist-итератора
на всех страницах. Можно переименовать аргумент, чтобы сделать его смысл более
понятным.
40. В функции, вызываемые из structure.conf аргументы передаются
    непосредственно из пути, без обработки. Производить обработку во всех
    функциях и написать строгое предупреждение в начале файла.
41. Плохо обрабатывается украинская "г", которую вставляют вместо еврейской.
42. Обложки МТ - 150 по ширине (ошибка с 58-го)!
43. Пакеты надо тоже удалять вместе с постингами (и вместе с файлом). При
копировании они не копируются.
44. Подредактировать список ComplainAction'ов - из-за удаления type_id они все
    смешались в одну кучу.

Прогресс пересмотра файлов
--------------------------

+ - готов
* - частично готов
- - не готов

Все остальные файлы, не упомянутые здесь, появились позже или удалены.

- actions/bookupload.php
+ actions/cadel.php
+ actions/camod.php
+ actions/checkcookies.php
+ actions/chmod.php
+ actions/complainact.php
+ actions/complainassign.php
+ actions/complainmod.php
+ actions/crossentryadd.php
+ actions/crossentrydel.php
+ actions/ear.php
+ actions/entryrenew.php
+ actions/forummod.php
+ actions/goto.php
+ actions/groupadd.php
+ actions/groupdel.php
+ actions/hide.php
- actions/horisontmod.php
+ actions/limdel.php
+ actions/limmod.php
+ actions/link.php
+ actions/login.php
+ actions/logout.php
+ actions/modbits.php
+ actions/moderatemass.php
+ actions/moderate.php
- actions/postingcopy.php
+ actions/postingdel.php
+ actions/postingmod.php
+ actions/postingorg-goto.php
+ actions/reorder.php
- actions/search.php
+ actions/shadow.php
- actions/style.php
+ actions/_template.php
+ actions/topicdel.php
+ actions/topicmod.php
- actions/userconfirm.php
- actions/userlost.php
+ actions/usermod.php
+ actions/userswitch.php
+ actions/vote.php

+ lib/alphabet.php
+ lib/answers.php
+ lib/array.php
+ lib/biff.php
+ lib/bug.php
+ lib/cache.php
+ lib/calendar.php
+ lib/calendar-tables.php
* lib/charsets.php (иврит и лигатуры не обрабатываются для текстов из файла)
+ lib/complainactions.php
+ lib/complainscripts.php
+ lib/complains.php
+ lib/counters.php
+ lib/cross-topics.php
+ lib/ctypes.php
+ lib/database.php
+ lib/dataobject.php
+ lib/errorreporting.php
+ lib/errors.php
+ lib/exec.php
* lib/forums.php
+ lib/gregor-calendar.php
+ lib/groups.php
+ lib/grpiterator.php
* lib/grps.php
- lib/horisonts.php
+ lib/ident.php
* lib/images.php (функции работы с файлами можно выделить отдельно)
+ lib/image-types.php
+ lib/image-upload.php
- lib/indexer.php
- lib/initstop-mail.php
+ lib/initstop.php
+ lib/inner.php
+ lib/ip.php
+ lib/iterator.php
+ lib/jewish-calendar.php
+ lib/jewish-calendar-utils.php
- lib/journal.php
+ lib/langs.php
+ lib/limitselect.php
+ lib/logging.php
- lib/logs.php
+ lib/mailings.php
- lib/mail.php
+ lib/mime.php
- lib/mnogosearch.php
+ lib/modbits.php
+ lib/no-cache.php
- lib/package.php
- lib/packages.php
+ lib/permissions.php
* lib/postings-info.php (кроме кэша)
* lib/postings.php
+ lib/postings-random.php
+ lib/post.php
- lib/profiling.php
+ lib/random.php
+ lib/redirs.php
- lib/replication.php
+ lib/rowscols.php
+ lib/run-script.php
+ lib/selectiterator.php
+ lib/select.php
+ lib/session.php
+ lib/sessions.php
+ lib/sort.php
+ lib/sql.php
- lib/stat.php
+ lib/style.php
+ lib/text.php
+ lib/tmptexts.php
+ lib/topics.php
+ lib/track.php
+ lib/unix-calendar.php
+ lib/uri.php (HTTPVarsIterator нужен?)
+ lib/users.php
+ lib/usertag.php
+ lib/utils.php
+ lib/votes.php

* scripts/daily.php
* scripts/hourly.php
- scripts/mailrobot.php
- scripts/packbooks.php
- scripts/pull.php
- scripts/replicate.php
- scripts/urlcheck.php

+ conf/counters.php
* conf/groups.conf
- conf/mailings.conf
+ conf/subdomains.php

- mailings/confirmed.mhtml
- mailings/registering.mhtml
- mailings/register.mhtml
- mailings/repairing-password.mhtml
- mailings/repair-password.mhtml

- pages/404.mhtml
- pages/500.mhtml
- pages/archive.mhtml
* pages/article.mhtml (кроме ловушек)
+ pages/article-times.mhtml
+ pages/book-chapter.mhtml
- pages/book-chapter-split.mhtml
* pages/book.mhtml (кроме пакетов и ловушек)
+ pages/book-print.mhtml
- pages/book-split.mhtml
- pages/book-static.mhtml
+ pages/chmod.mhtml
+ pages/complainactionedit.mhtml
* pages/complainanswer.mhtml (кроме ссылок на help)
* pages/complainedit.mhtml (кроме ссылок на help)
+ pages/complainforum.mhtml
+ pages/complains.mhtml
+ pages/cross-entries.mhtml
+ pages/cross-entry-add.mhtml
+ pages/daily-news.mhtml
+ pages/ears.mhtml
+ pages/event.mhtml
- pages/events-english.mhtml
+ pages/events.mhtml
+ pages/forumcatalog.mhtml (кроме ловушек)
+ pages/forumedit.mhtml (кроме ссылок на help и hidden для гостей)
+ pages/forum.mhtml
* pages/gallery.mhtml (кроме ловушек, статистики и notonly для блогов)
* pages/gallery-main.mhtml (кроме ловушек и статистики)
+ pages/groupadd.mhtml
+ pages/grouporg.mhtml
- pages/halom-main.mhtml (удалить, сохранив ловушку)
- pages/horisontedit.mhtml
- pages/index-english.mhtml
* pages/index-www.mhtml (кроме ловушек)
+ pages/jcc.mhtml
- pages/journal.mhtml
- pages/kaitana-main.mhtml (удалить, сохранив ловушку)
+ pages/limedit.mhtml
+ pages/liminsert.mhtml
+ pages/links.mhtml
+ pages/methodic-center.mhtml
+ pages/methodics.mhtml
+ pages/migdal.mhtml (кроме ловушек)
+ pages/migdal-library.mhtml
+ pages/migdal-library-novelties.mhtml
+ pages/migdal-news.mhtml
+ pages/modbits.mhtml
+ pages/moderator.mhtml
+ pages/peruser.mhtml
+ pages/peruser-user.mhtml
+ pages/postingedit.mhtml (кроме ссылок на help и hidden для гостей)
+ pages/posting.mhtml
* pages/postingorg.mhtml (исправить стиль сообщений об ошибках)
+ pages/printings.mhtml
+ pages/rating.mhtml
+ pages/register.mhtml
+ pages/reorder.mhtml
* pages/search.mhtml
- pages/stotext-help-subs.mhtml
- pages/stotext-help-types.mhtml
- pages/style.mhtml
- pages/_template.mhtml
+ pages/times.mhtml
+ pages/tips.mhtml
+ pages/topicdel.mhtml
+ pages/topicedit.mhtml
+ pages/topicorg.mhtml
+ pages/urls.mhtml
* pages/useredit.mhtml (кроме ссылок на help)
- pages/userfin.mhtml
+ pages/userinfo.mhtml
+ pages/userinfo-panel.mhtml
- pages/userlost.mhtml
+ pages/userok.mhtml
- pages/userrepair.mhtml
+ pages/users.mhtml

* pages/parts/article.mhtml
+ pages/parts/backtrace.mhtml
- pages/parts/bannerbank.mhtml
+ pages/parts/banners.mhtml
* pages/parts/book-chapters.mhtml (кроме пакетов)
- pages/parts/book-chapters-static.mhtml
+ pages/parts/book-ring.mhtml
- pages/parts/book-ring-static.mhtml
* pages/parts/bottom.mhtml
+ pages/parts/complain.mhtml
+ pages/parts/daily-announce.mhtml
+ pages/parts/daily-picture.mhtml
+ pages/parts/discussions.mhtml
+ pages/parts/ears.mhtml
+ pages/parts/events.mhtml
- pages/parts/failpage.mhtml
+ pages/parts/formutils.mhtml
+ pages/parts/forum.mhtml
+ pages/parts/forums.mhtml (кроме стиля сообщений об ошибках)
+ pages/parts/gallery-main.mhtml
+ pages/parts/gallery.mhtml
- pages/parts/googleru.mhtml
+ pages/parts/grpselect.mhtml
- pages/parts/hannukah.mhtml
- pages/parts/help-link.mhtml
+ pages/parts/history.mhtml
+ pages/parts/hit-parade.mhtml
- pages/parts/hotlog.mhtml
- pages/parts/jewishru.mhtml
+ pages/parts/langselect.mhtml
+ pages/parts/links-switcher.mhtml
+ pages/parts/login.mhtml
- pages/parts/mailru.mhtml
+ pages/parts/menu.mhtml
+ pages/parts/migdal-news.mhtml
+ pages/parts/peruser.mhtml
+ pages/parts/picture-main.mhtml
+ pages/parts/picture.mhtml
+ pages/parts/pointer.mhtml
* pages/parts/posting-book.mhtml
+ pages/parts/posting-ear.mhtml
* pages/parts/posting-general.mhtml
+ pages/parts/posting-link.mhtml
+ pages/parts/posting-peruser.mhtml
+ pages/parts/posting-printing.mhtml
+ pages/parts/posting.mhtml
+ pages/parts/postings-links.mhtml
+ pages/parts/postings.mhtml
+ pages/parts/postings-migdal-news.mhtml
+ pages/parts/posting-times-cover.mhtml
+ pages/parts/posting-times.mhtml
+ pages/parts/posting-tip.mhtml
- pages/parts/rabbi.mhtml
- pages/parts/rambler.mhtml
+ pages/parts/relogin.mhtml
* pages/parts/seealso.mhtml
+ pages/parts/spin.mhtml
+ pages/parts/subtitle.mhtml
+ pages/parts/textears.mhtml
+ pages/parts/tip.mhtml
+ pages/parts/today.mhtml
- pages/parts/top-404.mhtml
* pages/parts/topics-admin.mhtml
+ pages/parts/topics-book.mhtml
* pages/parts/topics-daily.mhtml
+ pages/parts/topicselect.mhtml
+ pages/parts/topics-events.mhtml
* pages/parts/topics-gallery-general.mhtml
+ pages/parts/topics-gallery-major.mhtml
+ pages/parts/topics-gallery-migdal.mhtml
* pages/parts/topics-general.mhtml (удалить)
- pages/parts/topics-help.mhtml
+ pages/parts/topics-links.mhtml
+ pages/parts/topics-major.mhtml
+ pages/parts/topics.mhtml
- pages/parts/topics-migdal-english.mhtml
* pages/parts/topics-migdal.mhtml
- pages/parts/topics-minor.mhtml
+ pages/parts/topics-peruser.mhtml
+ pages/parts/topics-times.mhtml
+ pages/parts/top.mhtml
+ pages/parts/tzdaka.mhtml
+ pages/parts/uploader.mhtml
+ pages/parts/userinfo.mhtml
+ pages/parts/utils.mhtml
+ pages/parts/vote.mhtml

* pages/report

@(#) $Id$
