Что необходимо менять при пересмотре кода
=========================================

1. idByIdent() и identById() не требуется таблица (entries по дефолту) и
поменялся порядок параметров.
2. В начале страниц и в начале action'ов требуется объявление всех параметров
(проверяется с register_globals = off). В том числе okdir, faildir и edittag.
3. Есть radio_button для <input type='radio'>.
4. Внутренний формат уже не HTML, а такой же, как исходник. Требуется
подстановка $=var для вставки в HTML простых строк, в которых могут быть
неэкранированные спецсимволы. Это не требуется, где есть методы *HTML() которые
конвертируют из внутреннего представления в уже подготовленный для HTML формат.
5. getWorldVars(), getAdminVars(), collectVars(), getNormal() упразднены.
6. PHP3 умер. Используем parent::, superglobals.
7. Размеры картинки меняются прямо в файле. Картинки больше не хранятся в
базе. Есть методы для получения путей к картинкам.
8. Функции, генерирующие SQL, сами обрабатывают свои параметры через
addslashes(), используя промежуточные переменные $*S (вообще почаще пользуемся
промежуточными переменными вместо конкатенации). Внешняя обработка не
требуется. 
9. Все переменные запроса хранятся в $Args. В скриптах заменяем $args на $Args.
10. Пользуемся __FUNCTION__ для получения имени функции. Имя метода получаем
как раньше.
11. *id-параметры превратились в _i-параметры и расшифровываются автоматически
в post*()-методах.
12. Метод Object::store() выносится как функция storeObject(). Аналогично и
другие методы, работающие с базой. Аргумент в storeObject() должен
передаваться по ссылке (!), чтобы записывать туда id новосозданного объекта.
13. HTMLSmth() переименовывается в SmthHTML().
14. is_int() иногда нужно заменить на is_numeric().
15. Пользуемся form_-тегами. formtable -> form_table.
16. Перестраиваем таблицы вместо border на комбинацию двух таблиц.
17. $`postings:kes` -> $`post.kes`.
18. Избавляемся от селекторов-вложений в CSS и переходим на имена классов типа
.form-cell, если возможно.
19. Избавляемся от иерархий классов в постингах и т.п.
20. Функции, работающие с базой, убираем из actions/ и кладем в lib/.
21. limit=0 по дефолту в итераторах по entries.
22. Ставить <label> везде, где только можно.
23. Не проводить операции с тенями на entries, не являющихся постингами. Не
предусматривать это ни в итераторах, ни в store().
24. Преобразование кодировок и форматов убрать из setup() и проводить либо
непосредственно при проверке параметров, либо при сохранении.
25. Объявлять переменную $METHOD там, где используется get_method() для
получения имени метода для sql().
26. Обработать parser'ы, чтобы генерируемый ими код также удовлетворял этим
требованиям.
27. Все (проверить!) ссылки должны быть переведены на ЧПУ.
28. <subtitle> теперь принимает непосредственный параметр, по умолчанию -
    заголовок страницы.
29. sqlDate() и sqlNow() при вставке времени в запрос.
30. Групповые GRP_ теперь не маски, а строки. Массивы, им соотвествующие,
берутся из $grpGroups (не забыть global!).
31. Убедиться, что все модифицирующие запросы реплицируются, включая операции
с картинками. Убедиться, что в команде репликации track указывается всегда
правильное имя таблицы.
32. У PostingListIterator/getPostingById поменялся набор SELECT_*;
33. Все ссылки должны быть абсолютными.
34. parent:: должен использоваться в конструкторах всех итераторов. Проверить
все случаи использования /$this->[A-Z]/
35. Проверить на отсутствие <pagetitle>.
36. Проверить все тексты на отсутствие XML error.
37. Проверить, что установлены ловушки на все старые URL'ы (проверять по
списку скриптов в предыдущем релизе).
38. В навигаторе тем на каждом уровне должен присутствовать <upper_level> со
ссылкой наверх. Сейчас он вставляется прямо в соответствующий <topic_*>.

Прогресс пересмотра файлов
--------------------------

+ - готов
* - частично готов
- - не готов

Все остальные файлы, не упомянутые здесь, появились позже или удалены.

- actions/bookupload.php
- actions/cadel.php
- actions/camod.php
- actions/chatpost.php
+ actions/checkcookies.php
- actions/chmod.php
- actions/complainact.php
- actions/complainassign.php
- actions/complainauto.php
- actions/complainmod.php
- actions/domainmod.php
- actions/ear.php
- actions/forumanswermod.php
+ actions/goto.php
- actions/groupadd.php
- actions/groupdel.php
- actions/hide.php
- actions/horisontmod.php
+ actions/limdel.php
+ actions/limmod.php
+ actions/link.php
+ actions/login.php
+ actions/logout.php
- actions/messagerenew.php
- actions/moderatemass.php
- actions/moderateone.php
- actions/moderate.php
- actions/postingcopy.php
- actions/postingdel.php
+ actions/postingmod.php
+ actions/postingorg-goto.php
* actions/reorder.php
- actions/search.php
- actions/shadow.php
- actions/style.php
+ actions/_template.php
+ actions/topicdel.php
- actions/topiclinkadd.php
- actions/topiclinkdel.php
+ actions/topicmod.php
- actions/topicsreorder.php
- actions/userconfirm.php
- actions/userlost.php
+ actions/usermod.php
+ actions/userswitch.php
- actions/vote.php

+ lib/alphabet.php
+ lib/answers.php
+ lib/array.php
+ lib/biff.php
+ lib/bug.php
+ lib/cache.php
+ lib/calendar.php
+ lib/calendar-tables.php
* lib/charsets.php (обработка иврита должна быть не при выводе)
* lib/chat.php (функции не обработаны)
- lib/chat-users.php
- lib/complainactions.php
- lib/complainscripts.php
- lib/complains.php
- lib/complaintypes.php
+ lib/counters.php
+ lib/cross-topics.php
+ lib/ctypes.php
+ lib/database.php
+ lib/dataobject.php
+ lib/errorreporting.php
+ lib/errors.php
+ lib/exec.php
- lib/forums.php
+ lib/gregor-calendar.php
- lib/groups.php
+ lib/grpiterator.php
* lib/grps.php
- lib/horisonts.php
+ lib/ident.php
* lib/images.php (функции работы с файлами можно выделить отдельно)
+ lib/image-types.php
+ lib/image-upload.php
- lib/indexer.php
- lib/initstop-mail.php
+ lib/initstop.php
+ lib/inner.php
+ lib/ip.php
+ lib/iterator.php
+ lib/jewish-calendar.php
+ lib/jewish-calendar-utils.php
- lib/journal.php
+ lib/langs.php
+ lib/limitselect.php
+ lib/logging.php
- lib/logs.php
+ lib/mailings.php
- lib/mail.php
* lib/messages.php (удалить)
+ lib/mime.php
- lib/mnogosearch.php
+ lib/modbits.php (только новые наборы флагов)
+ lib/no-cache.php
- lib/package.php
- lib/packages.php
+ lib/permissions.php
* lib/postings-info.php (кроме кэша)
* lib/postings.php
+ lib/postings-random.php
+ lib/post.php
- lib/profiling.php
+ lib/random.php
+ lib/redirs.php
- lib/replication.php
+ lib/rowscols.php
+ lib/run-script.php
+ lib/selectiterator.php
+ lib/select.php
+ lib/session.php
+ lib/sessions.php
+ lib/sort.php
+ lib/sql.php
- lib/stat.php
* lib/stotext-images.php (удалить, частично переведено в lib/inner-images.php)
- lib/stotext.php (удалить)
+ lib/style.php
+ lib/text.php
+ lib/tmptexts.php
+ lib/topics.php
+ lib/track.php
+ lib/unix-calendar.php
+ lib/uri.php (HTTPVarsIterator нужен?)
+ lib/users.php
+ lib/usertag.php
+ lib/utils.php
+ lib/votes.php

- scripts/chat.php
- scripts/daily.php
- scripts/hourly.php
- scripts/mailrobot.php
- scripts/packbooks.php
- scripts/pull.php
- scripts/replicate.php
- scripts/urlcheck.php

- migdal/grp/complains.conf
- migdal/grp/counters.php
* migdal/grp/groups.conf
- migdal/grp/mailings.conf
+ migdal/grp/subdomains.php

- migdal/mailings/confirmed.mhtml
- migdal/mailings/registering.mhtml
- migdal/mailings/register.mhtml
- migdal/mailings/repairing-password.mhtml
- migdal/mailings/repair-password.mhtml

- migdal/404.mhtml
- migdal/500.mhtml
- migdal/archive.mhtml
* migdal/article.mhtml (кроме ловушек)
- migdal/article-times.mhtml
- migdal/book-chapter.mhtml
- migdal/book-chapter-split.mhtml
- migdal/book.mhtml
- migdal/book-print.mhtml
- migdal/book-split.mhtml
- migdal/book-static.mhtml
* migdal/chatboard.mhtml
- migdal/chatbottom.mhtml
- migdal/chatconsole.mhtml
- migdal/chat.mhtml
- migdal/chattop.mhtml
- migdal/chatusers.mhtml
- migdal/chmod.mhtml
- migdal/complainactionedit.mhtml
- migdal/complainanswer.mhtml
- migdal/complainedit.mhtml
- migdal/complainforum.mhtml
- migdal/complains.mhtml
+ migdal/ears.mhtml
- migdal/event.mhtml
- migdal/events-english.mhtml
- migdal/events.mhtml
- migdal/forumansweredit.mhtml
- migdal/forumcatalog.mhtml
- migdal/forum.mhtml
* migdal/gallery.mhtml
* migdal/gallery-main.mhtml
- migdal/groupadd.mhtml
- migdal/grouporg.mhtml
- migdal/halom-main.mhtml
- migdal/halom.mhtml
- migdal/help.mhtml
- migdal/horisontedit.mhtml
- migdal/index-english.mhtml
* migdal/index-www.mhtml (кроме seealso и ловушек)
* migdal/jcc.mhtml (кроме seealso)
- migdal/journal.mhtml
- migdal/kaitana-main.mhtml
- migdal/kaitana.mhtml
+ migdal/limedit.mhtml
+ migdal/liminsert.mhtml
* migdal/links.mhtml (кроме seealso)
- migdal/methodic-center.mhtml
- migdal/methodics.mhtml
- migdal/migdal-library.mhtml
- migdal/migdal-library-news.mhtml
+ migdal/migdal.mhtml (кроме ловушек)
* migdal/migdal-news.mhtml
- migdal/modbits.mhtml
- migdal/moderator.mhtml
+ migdal/postingedit.mhtml (кроме ссылок на help)
+ migdal/posting.mhtml
* migdal/postingorg.mhtml
- migdal/printings.mhtml
+ migdal/rating.mhtml
+ migdal/register.mhtml
* migdal/reorder.mhtml
* migdal/search.mhtml
- migdal/stotext-help-subs.mhtml
- migdal/stotext-help-types.mhtml
- migdal/style.mhtml
- migdal/taglit.mhtml
- migdal/taglit-user.mhtml
- migdal/_template.mhtml
- migdal/times.mhtml
- migdal/tips.mhtml
+ migdal/topicdel.mhtml
+ migdal/topicedit.mhtml
- migdal/topiclinkadd.mhtml
- migdal/topiclinks.mhtml
+ migdal/topicorg.mhtml
- migdal/topics-reorder.mhtml
+ migdal/urls.mhtml
* migdal/useredit.mhtml (кроме ссылок на help)
- migdal/userfin.mhtml
+ migdal/userinfo.mhtml
+ migdal/userinfo-panel.mhtml
- migdal/userlost.mhtml
+ migdal/userok.mhtml
- migdal/userrepair.mhtml
+ migdal/users.mhtml
- migdal/veterans.mhtml
- migdal/veterans-user.mhtml

* migdal/parts/article.mhtml
* migdal/parts/backtrace.mhtml (удалить лишний код)
- migdal/parts/bannerbank.mhtml
+ migdal/parts/banners.mhtml
- migdal/parts/blog-gallery.mhtml
- migdal/parts/blog.mhtml
- migdal/parts/blog-posting.mhtml
- migdal/parts/book-chapters.mhtml
- migdal/parts/book-chapters-static.mhtml
- migdal/parts/book-ring.mhtml
- migdal/parts/book-ring-static.mhtml
* migdal/parts/bottom.mhtml
- migdal/parts/complain.mhtml
+ migdal/parts/discussions.mhtml
+ migdal/parts/ears.mhtml
- migdal/parts/events.mhtml
- migdal/parts/failpage.mhtml
+ migdal/parts/formutils.mhtml
- migdal/parts/forumanswer.mhtml
- migdal/parts/forumcatalog.mhtml
- migdal/parts/forums.mhtml
- migdal/parts/gallery-main.mhtml
+ migdal/parts/gallery.mhtml
- migdal/parts/googleru.mhtml
+ migdal/parts/grpselect.mhtml
- migdal/parts/hannukah.mhtml
- migdal/parts/help-link.mhtml
+ migdal/parts/history.mhtml
* migdal/parts/hit-parade.mhtml
- migdal/parts/hotlog.mhtml
- migdal/parts/identify.mhtml (удалить)
- migdal/parts/jewishru.mhtml
- migdal/parts/kaitana-announce.mhtml
- migdal/parts/kaitana-picture.mhtml
+ migdal/parts/langselect.mhtml
+ migdal/parts/links-switcher.mhtml
+ migdal/parts/login.mhtml
- migdal/parts/mailru.mhtml
+ migdal/parts/menu.mhtml
+ migdal/parts/migdal-news.mhtml
- migdal/parts/picture-main.mhtml
+ migdal/parts/picture.mhtml
- migdal/parts/pointer.mhtml
- migdal/parts/posting-book.mhtml
+ migdal/parts/posting-ear.mhtml
* migdal/parts/posting-general.mhtml
- migdal/parts/posting-library-announce.mhtml
+ migdal/parts/posting-link.mhtml
* migdal/parts/posting.mhtml
+ migdal/parts/postings-links.mhtml
+ migdal/parts/postings.mhtml
+ migdal/parts/postings-migdal-news.mhtml
- migdal/parts/posting-times-cover.mhtml
- migdal/parts/posting-times.mhtml
- migdal/parts/rabbi.mhtml
- migdal/parts/rambler.mhtml
+ migdal/parts/relogin.mhtml
- migdal/parts/seealso.mhtml
+ migdal/parts/spin.mhtml
+ migdal/parts/subtitle.mhtml
+ migdal/parts/textears.mhtml
+ migdal/parts/tip.mhtml
- migdal/parts/tip-posting.mhtml
- migdal/parts/today.mhtml
- migdal/parts/top-404.mhtml
* migdal/parts/topics-admin.mhtml
- migdal/parts/topics-blog.mhtml
- migdal/parts/topics-book.mhtml
+ migdal/parts/topicselect.mhtml
* migdal/parts/topics-events.mhtml
- migdal/parts/topics-gallery-general.mhtml
- migdal/parts/topics-gallery-major.mhtml
- migdal/parts/topics-gallery-migdal.mhtml
* migdal/parts/topics-general.mhtml (удалить)
- migdal/parts/topics-help.mhtml
- migdal/parts/topics-home.mhtml
- migdal/parts/topics-kaitana.mhtml
+ migdal/parts/topics-links.mhtml
* migdal/parts/topics-major.mhtml
+ migdal/parts/topics.mhtml
- migdal/parts/topics-migdal-english.mhtml
* migdal/parts/topics-migdal.mhtml
- migdal/parts/topics-minor.mhtml
- migdal/parts/topics-times.mhtml
+ migdal/parts/top.mhtml
+ migdal/parts/tzdaka.mhtml
+ migdal/parts/uploader.mhtml
+ migdal/parts/userinfo.mhtml
+ migdal/parts/utils.mhtml
+ migdal/parts/vote.mhtml

* migdal/report

@(#) $Id$
