Текстовые форматы
=================

Словом "stotext" в исходниках ядра обозначается текст, хранимый в базе данных.
Обычно он хранится в том же виде, в котором он был введен пользователем, а
отображается в зависимости от выбранного формата. Эти форматы, с одной стороны
обеспечивают простоту ввода текста, а с другой - простоту его машинной
обработки.

Во всех форматах абзацы разделяются пустой строкой. Это позволяет упростить
разбиение статей на страницы [NIF], усечение текстов до определенного размера и
вставку картинок в текст.

На данный момент существуют следующие форматы текста:

Простой (TF_PLAIN)

  При отображении этого формата разрывы строк делаются там же, где они сделаны
  в исходном тексте. Делаются также следующие замены:

    Текст                               Заменяется на
    -----                               -------------

    http://www.site.com                 <a href="http://www.site.com"
                                           target=_blank>
					http://www.site.com</a>

    'Сайт' http://www.site.com  (*)     <a href="http://www.site.com"
                                           target=_blank>
                                        Сайт</a>

    'Статья' /article.php  (***)        <a href="/article.php">
                                        Статья</a>

    balu@yes.ru                         <a href="mailto:balu@yes.ru">
                                        balu@yes.ru</a>

    БС"Д                                <img src='pics/bsd.gif'>

    _Текст_  (**)                       <u>Текст</u>

    ~Текст~  (**)                       <b>Текст</b>

    =Текст=  (**)                       <i>Текст</i>

    ^Текст^                             <sup>Текст</sup>

    #Текст#  (**)                       <tt>Текст</tt>

    Текст  (****)                       <h2>Текст</h2>
    =====

    Текст  (****)                       <h3>Текст</h3>
    -----

    Текст  (****)                       <h4>Текст</h4>
    ~~~~~

  (*) Текст должен быть заключен в _одинарные_ кавычки ('') и отделен от URL'а
      _одним_ пробелом.
  (**) Знаки подчеркивания, тильды, знаки равенства должны быть отделены
       пробелами или переводами строки от окружающего текста, то есть фраза
       "Это _надо_ подсвечивать" подсвечивается, а фраза
       "Это_не_надо_подсвечивать" не подсвечивается.
  (***) Текст должен быть заключен в _одинарные_ кавычки ('') и отделен от
        URL'а _одним_ пробелом. URL должен начинаться со слэша (/) и это
	означает, что ссылка локальная, поэтому открывается в том же окне и к
	ней прибавляется параметр redirid.
  (****) После строки с текстом должна идти строка, состоящая целиком из более
         чем трех символов =, - или ~.

  Текст, набранный с отступом более 10 символов, центрируется при отображении.

TeX-подобный (TF_TEX)

  В этом формате переводы строки, сделанные в исходном тексте, игнорируются.
  Если вы хотите разорвать строку в определенном месте, то в этом месте нужно
  вставить два обратных слэша (\\). Например:

    Этот текст будет отформатирован
    по ширине с разрывом строки
    в том месте, где вы поже\\лаете.
    Во всех остальных местах все
    будет зависеть от ширины страницы
    или ячейки таблицы.

  Будет выглядеть на странице так:

   +------------------------------------------------------+
   |Этот текст будет отформатирован по ширине с разрывом  |
   |строки в том месте, где вы поже                       |
   |лаете. Во всех остальных местах все будет зависеть от |
   |ширины страницы или ячейки таблицы.                   |
   +------------------------------------------------------+

  Все замены в тексте делаются аналогично TF_PLAIN.
  
HTML-подобный (TF_HTML)

  В этом формате, в отличие от остальных, не делаются никакие замены и
  допускаются любые теги HTML. При этом абзацы по прежнему разделяются пустой
  строкой и тег <p> использовать не нужно. Этот формат позволяет использовать
  всю мощь HTML при отображении текста, но он является потенциально опасным
  (см. примечание внизу).

Преформатированный (TF_PRE)

  Этот формат аналогичен TF_PLAIN с тем отличием, что текст при отображении
  заключается в теги <pre>...</pre> и подходит для отображения текстов
  программ, рисунков в ASCII art и т.п.

Письмо (TF_MAIL)

  Этот формат аналогичен TF_PLAIN, но при его отображении строки, начинающиеся
  с символов '>' считаются цитатой (как принято в письмах E-mail) и выделяются
  курсивом.

В сообщениях, форумах и чате используется формат TF_MAIL. В описании темы -
TF_PLAIN.

Все форматы, за исключением TF_HTML, проходят предварительную обработку
функцией htmlspecialchars() для нейтрализации тегов HTML в целях безопасности.
Поскольку TF_HTML допускает любые теги, будьте внимательны, чтобы текст в этом
формате прошел проверку модератором, прежде чем он попадет на общедоступную
HTML-страницу. Ядро форсирует такую проверку и выдает предупреждения, где
только возможно.

Based-on: lib/text.php 1.54
Based-on: lib/messages.php 1.67 (формат сообщений)
Based-on: lib/chat.php 1.5 (формат чата)
Based-on: lib/topics.php 1.50 (формат описаний)

@(#) $Id$
