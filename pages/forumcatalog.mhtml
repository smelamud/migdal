<< @(#) $Id$ >>

<grps>
<int name='offset'>

<log event=forumcatalog text#='offset=$offset'>

<element name='batcher' params='&list'>
<div class='batcher'>
 <div class='adder'>
  <image src='/pics/sheet.gif'>&sp;
  <a href='/forum/add/?redirid=$_'>Добавить тему</a>
 </div>
 <spin list='$list'>
 <div class='clear-floats'></div>
</div>
</element>

<html>
 <preamble>

 <top ident='discuss'>
 <div style='padding: 5px'>
  <iterate_users_now name='list' period='30'>
  <b class='ninept'>Сейчас на сайте:</b>&sp;
  <ifnzero what='$;Count'>
   <for>
    <notfirst what='$list'>,&sp;</notfirst>
    <senderlink message='$.'>
   </for>
  <else>
   никого из зарегистрированных
  </ifnzero>
  <guests_now period='30'>
  <ifnzero what='$,'>
   <array vals='гость,гостя,гостей'>
   <zone>
    <plural name='guests' value='$,'>
   </zone>
   &sp;и <em>$,</em> $guests
  </ifnzero>
  <br />
  <html_cache ident#='forumcatalog-$offset' period!='3 * 60 * 60'
              depends='postings,forums'>
   <grp_diff name='grp' grp1='*GRP_ALL' grp2='*GRP_FORUMS'>
   <iterate_postinglist grp='*GRP_DISCUSS' limit=20 offset='$offset'
                        sort='*SORT_PACTIVITY' withanswers='$grp'
                        showshadows='*false' as_guest='*true'>
   <if what='$$userId>0 || $;Count!=0'>
    <batcher list='$;'>
    <catalog_table>
     <tr valign=top>
      <th class='catalog-cell'>&nbsp;</th>
      <th class='catalog-cell'>Тема</th>
      <th class='catalog-cell'>Прислал(а)</th>
      <th class='catalog-cell'>Ответов</th>
      <th class='catalog-cell'>Последний ответ</th>
     </tr>
     <for name='posting'>
      <if what='$;isOdd'>
       <assign name='class' value='catalog-cell-odd'>
      <else>
       <assign name='class' value='catalog-cell'>
      </if>
      <ifnzero what='$.Answers'>
       <assign name='href' value#='/forum/$.Id/'>
      <else>
       <assign name='href' value#='/forum/$.Id/add/'>
      </ifnzero>
      <tr height=40>
       <td class='$class' width=30>
        <ifzero what='$.LastAnswer'>
         <biff time='$.Modified'>
        <else>
         <biff time='$.LastAnswer'>
        </ifzero>
       </td>
       <td class='$class'><asp>
        <if what='$.Priority<0'><b></if>
        <asp><a href='$href' class='ninept'>$=.Heading</a>
        <if what='$.Priority<0'></b></if>
        <assign name='portion' value='15'>
        <if what='$.Answers>$portion'>
         <span class='eightpt' style='white-space: nowrap'>
          <assign name='pages' value!='(int)($.Answers / $portion)'>
          <if what='$.Answers % $portion>0'>
           <assign name='pages' value!='$pages + 1'>
          </if>
          (Страницы:
          <if what='$pages>6'>
           <for n=3>
            <assign name='off' value!='$. * $portion'>
            <assign name='page' value!='$. + 1'>
            &sp;<a href='/forum/$posting.Id/?offset=$off'
                   class='ninept'>$page</a><asp>
           </for>
           &sp;...&sp;
           <for n=3>
            <assign name='off' value!='($pages + $. - 2) * $portion'>
            <assign name='page' value!='$. + 1'>
            &sp;<a href='/forum/$posting.Id/?offset=$off'
                   class='ninept'>$page</a><asp>
           </for>
          <else>
           <for n!='$pages'>
            <assign name='off' value!='$. * $portion'>
            <assign name='page' value!='$. + 1'>
            &sp;<a href='/forum/$posting.Id/?offset=$off'
                   class='ninept'>$page</a><asp>
           </for>
          </if>
          <asp>)
         </span>
        </if>
        <if what='$.TopicId!=$`forum`'>
         <br>
         <span class='subject eightpt'>(Раздел <topiclink posting='$.'>)</span>
        </if>
       </td>
       <td class='$class' align=center><senderlink message='$.'></td>
       <td class='$class' align=center>
        <a href='$href' class='ninept'>$.Answers</a>
       </td>
       <ifzero what='$.LastAnswer'>
        <td class='$class' align=center>&mdash;</td>
       <else>
        <td class='$class ninept'>
         <sentview date='$.LastAnswer'><br>
         <zone>
          <user_obj id='$.LastAnswerUserId'
                    guest_login='$.LastAnswerGuestLogin'>
          Автор: <senderlink message='$,'>&nbsp;
          <a href='$href?tid=$.LastAnswerId#t$.LastAnswerId'><asp>
           <image src='/pics/further-far.gif'
                  alt='К последнему ответу'
                  title='К последнему ответу'></a>
         </zone>
        </td>
       </ifzero>
      </tr>
     </for>
    </catalog_table>
    <ifnzero what='$;Count'>
     <batcher list='$;'>
    </ifnzero>
   <else>
    &nbsp;
   </if>
  </html_cache>
 </div>
 <bottom>
</html>
