# Makefile for Migdal website

# @(#) $Id$

targetdir=$(builddir)/www/

OBJECTS = 404.mhtml 500.mhtml archive.mhtml article.mhtml article-times.mhtml \
	  book.mhtml book-chapter.mhtml book-chapter-split.mhtml \
	  book-print.mhtml book-split.mhtml book-static.mhtml chat.mhtml \
	  chatboard.mhtml chatbottom.mhtml chatconsole.mhtml chattop.mhtml \
	  chatusers.mhtml chmod.mhtml complainactionedit.mhtml \
	  complainanswer.mhtml complainedit.mhtml complainforum.mhtml \
	  complains.mhtml cross-entries.mhtml cross-entry-add.mhtml \
	  daily-news.mhtml ears.mhtml event.mhtml events.mhtml \
	  events-english.mhtml forum.mhtml forumedit.mhtml forumcatalog.mhtml \
	  gallery.mhtml gallery-main.mhtml groupadd.mhtml grouporg.mhtml \
	  halom-main.mhtml horisontedit.mhtml index-english.mhtml \
	  index-www.mhtml jcc.mhtml journal.mhtml kaitana-main.mhtml \
	  limedit.mhtml liminsert.mhtml link.mhtml links.mhtml \
	  methodic-center.mhtml methodics.mhtml migdal.mhtml \
	  migdal-library.mhtml migdal-library-novelties.mhtml \
	  migdal-news.mhtml modbits.mhtml moderator.mhtml peruser.mhtml \
	  peruser-user.mhtml posting.mhtml postingedit.mhtml postingorg.mhtml \
	  printings.mhtml rating.mhtml register.mhtml register-confirm.mhtml \
	  register-error.mhtml register-ok.mhtml remember-password.mhtml \
	  remember-password-ok.mhtml reorder.mhtml search.mhtml \
	  search-google.mhtml setup.mhtml signin.mhtml stotext-help-subs.mhtml \
	  stotext-help-types.mhtml textears.mhtml times.mhtml tips.mhtml \
	  topicdel.mhtml topicedit.mhtml topicorg.mhtml urls.mhtml \
	  useredit.mhtml userinfo.mhtml userinfo-panel.mhtml users.mhtml
	  
$(targetdir)/.stamp:
	-mkdir -p $(targetdir)
	-mkdir -p $(targetdir)/books
	-mkdir -p $(targetdir)/images
	touch $@

$(targetdir)/.htaccess: $(targetdir)/.stamp favicon.ico dispatcher.php \
		.htaccess robots.txt
	cp favicon.ico dispatcher.php .htaccess robots.txt $(targetdir)

$(targetdir)/%.php: %.mhtml $(targetdir)/.stamp ../miparser \
		../macros.mhtml macros.mhtml
	../miparser -M ../macros.mhtml -M macros.mhtml $< > $@

all: $(targetdir)/.htaccess $(OBJECTS:%.mhtml=$(targetdir)/%.php)
	(cd js; $(MAKE) all)
	(cd parts; $(MAKE) all)
	(cd pics; $(MAKE) all)
	(cd styles; $(MAKE) all)

Makefile: Makefile.in ../conf/migdal.conf
	../confmake $^ $(builddir) > Makefile

clean:
	(cd parts; $(MAKE) clean)
	(cd styles; $(MAKE) clean)
