<< @(#) $Id$ >>

<<
1. Если поле something отсутствует из-за того, что редактор данного типа
   сообщения его не предусматривает, оно должно присутствовать в виде hidden,
   поскольку может присутствовать в других тенях этого же сообщения. В
   противном случае actions/postingmod.php затрет это поле.
2. Все поля должны включаться, если $full!=0.
>>

<grps>
<image_upload>
<ident name='editid'>
<ident name='parent_id'>
<int name='grp'>
<int name='up'>
<int name='index1'>
<int name='full'>
<int name='noguests'>

<int name='relogin'>
<string name='login'>
<int name='remember'>

<int name='edittag'>
<int name='index2'>
<string name='body'>
<int name='body_format'>
<string name='large_body'>
<string name='large_body_filename'>
<int name='del_large_body'>
<int name='large_body_format'>
<string name='subject'>
<string name='author'>
<string name='source'>
<string name='comment0'>
<string name='comment1'>
<string name='title'>
<string name='url'>
<int name='priority'>
<string name='ident'>
<string name='lang'>
<int name='small_image'>
<int name='small_image_x'>
<int name='small_image_y'>
<int name='large_image'>
<int name='large_image_x'>
<int name='large_image_y'>
<int name='large_image_size'>
<string name='large_image_format'>
<string name='large_image_filename'>
<int name='person_id'>
<int name='hidden'>
<int name='disabled'>
<int name='sent'>

<posting_obj id='$editid' grp='$grp' topic_id='$parent_id' up='$up'
             index1='$index1' fields!='*SELECT_GENERAL|*SELECT_LARGE_BODY'>

<macro name='full'>
 <if what='$$full'>
</macro>
<endif name='/full'>

<full>
 <assign name='root' value='-1'>
<else>
 <assign name='root' value='$posting.RootId'>
 <if what='$root!=-1'>
  <assign name='root' value='$`$root`'>
 </if>
</full>
<if what='$grp<=0 && $posting.Grp>0'>
 <assign name='grp' value='$posting.Grp'>
</if>

<element name='editor_line' params='posting,editor,visible'>
<assign name='ident' value='$editor.Ident'>
<assign name='xmlid' value!='$$full ? $posting.Id : 0'>
<if what="$ident=='' || $ident[0]=='_'">
 <if what='$visible'>
  <form_section title='$=editor.Title'>
 </if>
<elif what="$ident=='priority'">
 <if what='$visible'>
  <form_edit title='$=editor.Title' comment='$editor.Comment' name='priority'
             value='$posting.Priority' size=4 maxlength=3
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='priority' value='$posting.Priority'>
 </if>
<elif what="$ident=='topic'">
 <if what='$visible'>
  <form_topicselect title='$=editor.Title' comment='$editor.Comment'
                    name='parent_id' value='$posting.ParentId' grp='$$grp'
	            mandatory='$editor.isMandatory' root='$$root'
	            only_postable='*true'>
 <else>
  <hidden name='parent_id' value='$posting.TopicId'>
 </if>
<elif what="$ident=='ident'">
 <if what='$visible'>
  <error id='*EP_IDENT_ABSENT' text='Обозначение не указано'>
  <error id='*EP_IDENT_UNIQUE' text='Так уже обозначено другое сообщение'>
  <form_edit title='$=editor.Title' comment='$editor.Comment' name='ident'
             value='$posting.Ident' size=20 maxlength=75
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='ident' value='$posting.Ident'>
 </if>
<elif what="$ident=='subject'">
 <if what='$visible'>
  <error id='*EP_SUBJECT_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$editor.Comment'
             value='$=posting.Subject' name='subject' size=70 maxlength=250
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='subject' value='$=posting.Subject'>
 </if>
<elif what="$ident=='author'">
 <if what='$visible'>
  <error id='*EP_AUTHOR_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$editor.Comment'
             value='$=posting.Author' name='author' size=52 maxlength=250
	     mandatory='$editor.isMandatory' xmlid='$xmlid'>
 <else>
  <hidden name='author' value='$=posting.Author'>
 </if>
<elif what="$ident=='source'">
 <if what='$visible'>
  <error id='*EP_SOURCE_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$editor.Comment'
             value='$=posting.Source' name='source' size=52 maxlength=250
	     mandatory='$editor.isMandatory' xmlid='$xmlid'>
 <else>
  <hidden name='source' value='$=posting.Source'>
 </if>
<elif what="$ident=='comment0'">
 <if what='$visible'>
  <form_edit title='$=editor.Title' comment='$editor.Comment'
             value='$=posting.Comment0' name='comment0' size=52 maxlength=250
	     mandatory='$editor.isMandatory' xmlid='$xmlid'>
 <else>
  <hidden name='comment0' value='$=posting.Comment0'>
 </if>
<elif what="$ident=='body'">
 <if what='$visible'>
  <error id='*EP_BODY_ABSENT' text='Текст пуст'>
  <form_editor title='$=editor.Title' comment='$editor.Comment'
               name='body' body='$=posting.Body' rows=9
	       mandatory='$editor.isMandatory' xmlid='$xmlid'>
 <else>
  <hidden name='body' value='$=posting.Body'>
 </if>
<elif what="$ident=='body_format'">
 <if what='$visible'>
  <form_upload_format title='$=editor.Title' comment='$editor.Comment'
		      name='body_format' format='$posting.BodyFormat'
		      mandatory='$editor.isMandatory'>
 <else>
  <hidden name='body_format' value='$posting.BodyFormat'>
 </if>
<elif what="$ident=='index1'">
 <if what='$visible'>
  <error id='*EP_INDEX1_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$editor.Comment'
             value='$posting.Index1' name='index1' size=3 maxlength=5
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='index1' value='$posting.Index1'>
 </if>
<elif what="$ident=='index2'">
 <if what='$visible'>
  <if what="$editor.Style=='issue-length'">
   <form_select title='$=editor.Title' comment='$editor.Comment'
	        name='index2' mandatory='$editor.isMandatory'>
    <form_option title='Обычный номер' value=0 selected!='$posting.Index2==0'>
    <form_option title='Сдвоенный номер' value=1 selected!='$posting.Index2==1'>
    <form_option title='Строенный номер' value=2 selected!='$posting.Index2==2'>
    <form_option title='Счетверенный номер' value=3
                 selected!='$posting.Index2==3'>
   </form_select>
  <else>
   <form_edit title='$=editor.Title' comment='$editor.Comment'
	      value='$posting.Index2' name='index2' size=3 maxlength=5
	      mandatory='$editor.isMandatory'>
  </if>
 <else>
  <hidden name='index2' value='$posting.Index2'>
 </if>
<elif what="$ident=='lang'">
 <if what='$visible'>
  <error id='*EP_LANG_ABSENT' text#='$=editor.Title не указан'>
  <form_langselect title='$=editor.Title' comment='$editor.Comment'
                   value='$posting.Lang' name='lang'
	           mandatory='$editor.isMandatory'>
 <else>
  <hidden name='lang' value='$posting.Lang'>
 </if>
<elif what="$ident=='url'">
 <if what='$visible'>
  <error id='*EP_URL_ABSENT' text#='$=editor.Title не указана'>
  <form_edit title='$=editor.Title' comment='$editor.Comment'
             value='$=posting.URL' name='url' size=52 maxlength=250
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='url' value='$=posting.URL'>
 </if>
<elif what="$ident=='image'">
 <if what='$visible'>
  <error id='*EP_IMAGE_ABSENT' text='Нужно указать картинку для отображения'>
  <error id='*EP_NO_IMAGE' text='Указанной картинки не существует'>
  <error id='*EIU_UNKNOWN_IMAGE' text='Неизвестный формат картинки'>
  <error id='*EIU_IMAGE_LARGE' text='Картинка слишком велика (больше 2M)'>
  <error id='*EIU_THUMBNAIL_LARGE'
         text='Маленькая картинка слишком велика (больше 2M)'>
  <error id='*EIU_UNKNOWN_THUMBNAIL'
	 text='Формат маленькой картинки, указанный при конфигурации сервера,
	       не поддерживается, либо вы загрузили картинку не этого формата'>
  <error id='*EP_LARGE_IMAGE_EXACT'
         text#='Картинка должна быть размером ${editor.ImageExactX}x$editor.ImageExactY'>
  <error id='*EP_LARGE_IMAGE_EXACT_X'
         text#='Картинка должна быть шириной $editor.ImageExactX пикселов'>
  <error id='*EP_LARGE_IMAGE_EXACT_Y'
         text#='Картинка должна быть высотой $editor.ImageExactY пикселов'>
  <error id='*EP_SMALL_IMAGE_EXACT'
         text#='Уменьшенная картинка должна быть размером ${editor.ThumbExactX}x$editor.ThumbExactY'>
  <error id='*EP_SMALL_IMAGE_EXACT_X'
         text#='Уменьшенная картинка должна быть шириной $editor.ThumbExactX пикселов'>
  <error id='*EP_SMALL_IMAGE_EXACT_Y'
         text#='Уменьшенная картинка должна быть высотой $editor.ThumbExactY пикселов'>
  <error id='*EP_LARGE_IMAGE_MAX'
         text#='Картинка должна быть размером не более ${editor.ImageMaxX}x$editor.ImageMaxY'>
  <error id='*EP_LARGE_IMAGE_MAX_X'
         text#='Картинка должна быть шириной не более $editor.ImageMaxX пикселов'>
  <error id='*EP_LARGE_IMAGE_MAX_Y'
         text#='Картинка должна быть высотой не более $editor.ImageMaxY пикселов'>
  <error id='*EP_SMALL_IMAGE_MAX'
         text#='Уменьшенная картинка должна быть размером не более ${editor.ThumbMaxX}x$editor.ThumbMaxY'>
  <error id='*EP_SMALL_IMAGE_MAX_X'
         text#='Уменьшенная картинка должна быть шириной не более $editor.ThumbMaxX пикселов'>
  <error id='*EP_SMALL_IMAGE_MAX_Y'
         text#='Уменьшенная картинка должна быть высотой не более $editor.ThumbMaxY пикселов'>
  <if what='$posting.hasSmallImage'>
   <hidden name='small_image' value='$posting.SmallImage'>
   <hidden name='small_image_x' value='$posting.SmallImageX'>
   <hidden name='small_image_y' value='$posting.SmallImageY'>
   <hidden name='large_image' value='$posting.LargeImage'>
   <hidden name='large_image_x' value='$posting.LargeImageX'>
   <hidden name='large_image_y' value='$posting.LargeImageY'>
   <hidden name='large_image_size' value='$posting.LargeImageSize'>
   <hidden name='large_image_format' value='$posting.LargeImageFormat'>
   <hidden name='large_image_filename' value='$posting.LargeImageFilename'>
   <assign name='loaded' value#='Загружен файл $=posting.LargeImageFilename
                                 (${posting.ImageX}x$posting.ImageY,
				  ${posting.LargeImageSizeKB}K)'>
   <assign name='small_url' value!="$,hasLargeImage ? $,SmallImageURL : ''">
   <assign name='large_url'
	   value!="$,hasLargeImage ? $,LargeImageURL : $,SmallImageURL">
  <else>
   <assign name='loaded' value=''>
  </if>
  <assign name='flags' value!='$editor.UploadFlags & *IU_THUMB'>
  <if what='$flags!=*IU_THUMB_MANUAL && $flags!=*IU_THUMB_RESIZE'>
   <form_uploader title='$=editor.Title' comment='$editor.Comment'
		  name='image_file' loaded='$loaded' delname='del_image'
		  small_url='$small_url' large_url='$large_url'
		  mandatory='$editor.isMandatory'>
  <else>
   <form_uploader title='$=editor.Title' comment='$editor.Comment'
		  name='image_file' small_name='image_file_thumb'
		  small_title='Маленькая:' large_title='Большая:'
		  loaded='$loaded' delname='del_image'
		  small_url='$small_url' large_url='$large_url'
		  mandatory='$editor.isMandatory'>
  </if>
 <else>
  <hidden name='small_image' value='$posting.SmallImage'>
  <hidden name='small_image_x' value='$posting.SmallImageX'>
  <hidden name='small_image_y' value='$posting.SmallImageY'>
  <hidden name='large_image' value='$posting.LargeImage'>
  <hidden name='large_image_x' value='$posting.LargeImageX'>
  <hidden name='large_image_y' value='$posting.LargeImageY'>
  <hidden name='large_image_size' value='$posting.LargeImageSize'>
  <hidden name='large_image_format' value='$posting.LargeImageFormat'>
  <hidden name='large_image_filename' value='$posting.LargeImageFilename'>
 </if>
<elif what="$ident=='title'">
 <if what='$visible'>
  <form_editor title='$=editor.Title' comment='$editor.Comment'
               name='title' body='$=posting.Title' rows=3
	       mandatory='$editor.isMandatory' xmlid='$xmlid'>
 <else>
  <hidden name='title' value='$=posting.Title'>
 </if>
<elif what="$ident=='large_body'">
 <if what='$visible'>
  <error id='*EP_LARGE_BODY_ABSENT' text#='$=editor.Title пуст'>
  <form_editor title='$=editor.Title' comment='$editor.Comment'
               name='large_body' body='$=posting.LargeBody' rows=11
	       mandatory='$editor.isMandatory' xmlid='$xmlid'>
 <else>
  <hidden name='large_body' value='$=posting.LargeBody'>
 </if>
<elif what="$ident=='large_body_upload'">
 <if what='$visible'>
  <error id='*EUL_LARGE' text#='$=editor.Title слишком велик (больше 2M)'>
  <if what='$posting.hasLargeBody'>
   <ifne what='$posting.LargeBodyFilename'>
    <assign name='loaded' value#='Загружен файл $=posting.LargeBodyFilename
				  (${posting.LargeBodySizeKB}K)'>
   <else>
    <assign name='loaded' value#='Загружен текст (${posting.LargeBodySizeKB}K)'>
   </ifne>
  <else>
   <assign name='loaded' value=''>
  </if>
  <form_uploader title='$=editor.Title' comment='$editor.Comment'
                 name='large_body_file' loaded='$loaded'
		 delname='del_large_body' mandatory='$editor.isMandatory'
		 plainid='$posting.Id'>
 </if>
<elif what="$ident=='large_body_format'">
 <if what='$visible'>
  <form_upload_format title='$=editor.Title' comment='$editor.Comment'
		      name='large_body_format'
		      format='$posting.LargeBodyFormat'
		      mandatory='$editor.isMandatory'>
 <else>
  <hidden name='large_body_format' value='$posting.LargeBodyFormat'>
 </if>
<elif what="$ident=='sent'">
 <if what='$visible'>
  <form_date title='$=editor.Title' comment='$editor.Comment'
             name='sent' value='$posting.Sent'
	     mandatory='$editor.isMandatory' base_year='$editor.Base'>
 </if>
<else>
 <form_section title='$ident'>
</if>
</element>

<html>
<preamble>
<body>
 <top ident='index'>
 <setup>
 <if what='$editid'>
  <assign name='head' value#='Редактирование $,GrpWhatV'>
 <else>
  <assign name='head' value#='Добавление $posting.GrpWhatV'>
 </if>
 <form_table title='$head'>
  <form method=post enctype='multipart/form-data'
	action='/actions/posting/modify'>
   <hidden name='edittag' value=1>
   <hidden name='okdir' value='$--'>
   <hidden name='faildir' value='$-'>
   <hidden name='full' value='$full'>
   <hidden name='editid' value='$editid'>
   <hidden name='person_id' value='$,PersonId'>
   <hidden name='up' value='$,UpValue'>
   <starinfo>
   <error id='*EP_NO_EDIT' text='У вас нет права редактировать это сообщение'>
   <error id='*EP_NO_PERSON'
	  text='У этого пользователя нет персональной страницы'>
   <error id='*EP_INVALID_GRP' text='Такого типа сообщения не существует'>
   <error id='*EP_TOPIC_ABSENT' text='Тема должна быть выбрана'>
   <error id='*EP_TOPIC_ACCESS'
	  text='Вы не имеете права добавлять сообщения по этой теме'>
   <error id='*EVH_NO_PARENT' text='Такой темы не существует'>
   <error id='*EVH_NO_UP' text='Вышестоящего сообщения не существует'>
   <error id='*EVH_LOOP' text='Сообщение не может быть подчиненным себе'>
   <error id='*EVH_NOT_UP_UNDER_PARENT'
          text='Тема вышестоящего сообщения должна совпадать с этой темой'>
   <error id='*EVH_INCORRECT' text='Нарушение иерархии объектов'>
   <error id='*EP_UP_APPEND'
	  text='Вы не имеете права присоединять сообщения к этому сообщению'>
   <moderator>
    <form_comment><table><tr>
     <full>
      <td><image src='/pics/down.gif'></td>
      <td><a href='$[full=0]'>Скрыть все неиспользуемые поля</a></td>
     <else>
      <td><image src='/pics/right.gif'></td>
      <td><a href='$[full=1]'>Показать все поля</a></td>
     </full>
    </tr></table></form_comment>
   </moderator>
   <if what='!$editid'>
    <form_relogin noguests='$noguests' relogin='$relogin' login='$login'
                  remember='$remember'>
   </if>
   <full>
    <form_grpselect title='Группа' mandatory='*true' name='grp' value='$,Grp'>
   <else>
    <hidden name='grp' value='$,Grp'>
   </full>
   <iterate_grp_editor grp!='!$full ? $,Grp : *GRP_NONE'>
   <for>
    <editor_line posting='$,' editor='$.' visible='*true'>
   </for>
   <iterate_grp_editor grp!='!$full ? $,Grp : *GRP_NONE' inverse='*true'>
   <for>
    <editor_line posting='$,' editor='$.' visible='*false'>
   </for>
   <moderator>
    <assign name='who' value='автору'>
   <else>
    <assign name='who' value='мне'>
   </moderator>
   <logged>
    <form_select title='Видимость' name='hidden' style='box'>
     <form_option title='Сообщение видно всем пользователям' value='0'
                  selected!='!$,isHidden'>
     <form_option title#='Сообщение видно только $who и модераторам' value='1'
                  selected='$,isHidden'>
    </form_select>
   <else>
    <hidden name='hidden' value='0'>
   </logged>
   <full>
    <form_select title='Запретить показ'
                 comment='Модераторский запрет на показ сообщения. Пользователь
		          не может снять этот запрет.'
		 name='disabled' style='box'>
     <form_option title='Нет запрета на показ всем пользователям' value='0'
                  selected!='!$,isDisabled'>
     <form_option title#='Разрешено показывать только $who и модераторам'
                  value='1' selected='$,isDisabled'>
    </form_select>
   <else>
    <hidden name='disabled' value='$,isDisabled'>
   </full>
   <if what='$editid'>
    <form_buttons title='Изменить'>
   <else>
    <form_buttons title='Добавить'>
   </if>
  </form>
 </form_table>
 <bottom>
</body>
</html>
