# Makefile for Migdal website

# @(#) $Id$

targetdir=$(builddir)/www/styles/

FLAVOURS = default print
STYLE_PARTS = colors.less fonts.less palette.less sheet-general.less \
	sheet-anytoany.less sheet-frames.less sheet-info.less sheet-menu.less \
	sheet-bottom.less sheet-top.less sheet-return.less sheet-batcher.less \
	sheet-posting.less sheet-textears.less sheet-forum.less \
	sheet-topics.less sheet-catalog.less sheet-picture.less sheet-form.less \
	sheet-heading.less sheet-seealso.less sheet-register.less sheet-votes.less \
	sheet-article.less sheet-times.less sheet-book.less sheet-index.less \
	sheet-userinfo.less

STATIC_ARTICLE_PARTS = colors.less fonts.less palette.less sheet-general.less \
	sheet-article.less

all: $(targetdir)/static-article.css \
		$(patsubst %,$(targetdir)/style-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/style-%.min.css,$(FLAVOURS))
	find humanity/ -name '*.css' -o -name '*.png' -o -name '*.gif' | \
		xargs -i cp --parents {} $(targetdir)
	cp jquery.qtip-*.css $(targetdir)

$(targetdir)/style-%.min.css: style.less $(STYLE_PARTS)
	[ -d $(targetdir) ] || mkdir -p $(targetdir)
	../../lessc -x --global-var='flavour=$*' $< > $@

$(targetdir)/style-%.css: style.less $(STYLE_PARTS)
	[ -d $(targetdir) ] || mkdir -p $(targetdir)
	../../lessc --global-var='flavour=$*' $< > $@

$(targetdir)/static-article.css: static-article.less $(STATIC_ARTICLE_PARTS)
	[ -d $(targetdir) ] || mkdir -p $(targetdir)
	../../lessc --global-var='flavour=default' $< > $@

Makefile: Makefile.in ../../conf/migdal.conf
	../../confmake $^ $(builddir) > Makefile

clean:
	-rm $(targetdir)/*.css
