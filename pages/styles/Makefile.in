# Makefile for Migdal website

# @(#) $Id$

targetdir=$(builddir)/www/styles/

FLAVOURS = default print
STYLE_PARTS = colors.less fonts.less palette.less sheet-general.less \
	sheet-anytoany.less sheet-frames.less sheet-info.less sheet-menu.less \
	sheet-bottom.less sheet-top.less sheet-return.less sheet-batcher.less \
	sheet-posting.less sheet-textears.less sheet-forum.less \
	sheet-topics.less sheet-catalog.less sheet-picmain.less \
	sheet-picture.less sheet-form.less sheet-heading.less \
	sheet-seealso.less sheet-register.less sheet-votes.less \
	sheet-article.less sheet-times.less sheet-timesnfo.less sheet-book.less \
	sheet-index.less

STATIC_ARTICLE_PARTS = colors.less fonts.less palette.less sheet-general.less \
	sheet-article.less

all: $(targetdir)/.style.stamp $(targetdir)/static-article.css

$(targetdir)/.stamp:
	-mkdir -p $(targetdir)
	touch $@

$(targetdir)/style-%.min.css: style.less $(targetdir)/.stamp $(STYLE_PARTS)
	../../lessc -x --global-var='flavour=$*' $< > $@

$(targetdir)/style-%.css: style.less $(targetdir)/.stamp $(STYLE_PARTS)
	../../lessc --global-var='flavour=$*' $< > $@

$(targetdir)/.style.stamp: $(patsubst %,$(targetdir)/style-%.css,$(FLAVOURS)) \
		 $(patsubst %,$(targetdir)/style-%.min.css,$(FLAVOURS))
	touch $@

$(targetdir)/static-article.css: static-article.less $(targetdir)/.stamp \
		$(STATIC_ARTICLE_PARTS)
	../../lessc --global-var='flavour=default' $< > $@

Makefile: Makefile.in ../../conf/migdal.conf
	../../confmake $^ $(builddir) > Makefile

clean:
	-rm $(targetdir)/.*.stamp $(targetdir)/static-article.css
