# Makefile for Migdal website

# @(#) $Id$

targetdir=$(builddir)/www/styles/

FLAVOURS = default print
STYLE_PARTS = colors.mcss fonts.mcss palette.mcss sheet-general.mcss \
	sheet-frames.mcss sheet-info.mcss sheet-menu.mcss sheet-bottom.mcss \
	sheet-login.mcss sheet-return.mcss sheet-batcher.mcss \
	sheet-posting.mcss sheet-textears.mcss sheet-forum.mcss \
	sheet-topics.mcss sheet-catalog.mcss sheet-picmain.mcss \
	sheet-picture.mcss sheet-form.mcss sheet-heading.mcss \
	sheet-seealso.mcss
ARTICLE_PARTS = colors.mcss fonts.mcss palette.mcss sheet-article.mcss
BOOK_PARTS = colors.mcss fonts.mcss palette.mcss sheet-book.mcss
CHAT_PARTS = colors.mcss fonts.mcss palette.mcss sheet-general.mcss \
	sheet-chat.mcss
COMPLAIN_PARTS = colors.mcss fonts.mcss palette.mcss sheet-complain.mcss
INDEX_PARTS = colors.mcss fonts.mcss palette.mcss sheet-index.mcss
TIMES_PARTS = colors.mcss fonts.mcss palette.mcss sheet-times.mcss
TIMESNFO_PARTS = colors.mcss fonts.mcss palette.mcss sheet-timesnfo.mcss
VOTES_PARTS = colors.mcss fonts.mcss palette.mcss sheet-general.mcss \
	sheet-votes.mcss

STATIC_ARTICLE_PARTS = colors.mcss fonts.mcss palette.mcss sheet-general.mcss \
	sheet-article.mcss

all: $(targetdir)/.style.stamp $(targetdir)/.article.stamp \
	$(targetdir)/.book.stamp $(targetdir)/.chat.stamp \
	$(targetdir)/.complain.stamp $(targetdir)/.index.stamp \
	$(targetdir)/.times.stamp $(targetdir)/.timesnfo.stamp \
	$(targetdir)/.votes.stamp $(targetdir)/static-article.css

$(targetdir)/.stamp:
	-mkdir -p $(targetdir)
	touch $@

$(targetdir)/style-%.php: style.mcss $(targetdir)/.stamp $(STYLE_PARTS) \
		../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/style-%.css: style.mcss $(targetdir)/.stamp $(STYLE_PARTS) \
		../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.style.stamp: $(patsubst %,$(targetdir)/style-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/style-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/article-%.php: article.mcss $(targetdir)/.stamp $(ARTICLE_PARTS) \
		../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/article-%.css: article.mcss $(targetdir)/.stamp $(ARTICLE_PARTS) \
		../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.article.stamp: $(patsubst %,$(targetdir)/article-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/article-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/book-%.php: book.mcss $(targetdir)/.stamp $(BOOK_PARTS) \
		../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/book-%.css: book.mcss $(targetdir)/.stamp $(BOOK_PARTS) \
		../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.book.stamp: $(patsubst %,$(targetdir)/book-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/book-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/chat-%.php: chat.mcss $(targetdir)/.stamp $(CHAT_PARTS) \
		../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/chat-%.css: chat.mcss $(targetdir)/.stamp $(CHAT_PARTS) \
		../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.chat.stamp: $(patsubst %,$(targetdir)/chat-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/chat-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/complain-%.php: complain.mcss $(targetdir)/.stamp \
		$(COMPLAIN_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/complain-%.css: complain.mcss $(targetdir)/.stamp \
		$(COMPLAIN_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.complain.stamp: $(patsubst %,$(targetdir)/complain-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/complain-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/index-%.php: index.mcss $(targetdir)/.stamp $(INDEX_PARTS) \
		../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/index-%.css: index.mcss $(targetdir)/.stamp $(INDEX_PARTS) \
		../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.index.stamp: $(patsubst %,$(targetdir)/index-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/index-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/times-%.php: times.mcss $(targetdir)/.stamp $(TIMES_PARTS) \
		../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/times-%.css: times.mcss $(targetdir)/.stamp $(TIMES_PARTS) \
		../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.times.stamp: $(patsubst %,$(targetdir)/times-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/times-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/timesnfo-%.php: timesnfo.mcss $(targetdir)/.stamp \
		$(TIMESNFO_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/timesnfo-%.css: timesnfo.mcss $(targetdir)/.stamp \
		$(TIMESNFO_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.timesnfo.stamp: $(patsubst %,$(targetdir)/timesnfo-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/timesnfo-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/votes-%.php: votes.mcss $(targetdir)/.stamp $(VOTES_PARTS) \
		../../cssparser
	../../cssparser -p -s $* $< > $@

$(targetdir)/votes-%.css: votes.mcss $(targetdir)/.stamp $(VOTES_PARTS) \
		../../cssparser
	../../cssparser -s $* $< > $@

$(targetdir)/.votes.stamp: $(patsubst %,$(targetdir)/votes-%.css,$(FLAVOURS)) \
		$(patsubst %,$(targetdir)/votes-%.php,$(FLAVOURS))
	touch $@

$(targetdir)/static-article.css: static-article.mcss $(targetdir)/.stamp \
		$(STATIC_ARTICLE_PARTS) ../../cssparser
	../../cssparser -s static-article.css $< > $@

Makefile: Makefile.in ../../conf/migdal.conf
	../../confmake $^ $(builddir) > Makefile

clean:
	-rm $(targetdir)/.*.stamp $(targetdir)/static-article.css
