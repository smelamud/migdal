# Makefile for Migdal kernel

# @(#) $Id$

targetdir=$(builddir)/www/conf/

CONFIGS = migdal.conf .htaccess counters.php subdomains.php titles.php \
          scripts.php traps.php cross-entries.php forums.php

all: $(targetdir)/migdal.conf $(targetdir)/grps.php $(targetdir)/grpentry.php \
	$(targetdir)/mailings.php $(targetdir)/structure.php ;

Makefile: Makefile.in migdal.conf
	../confmake $^ $(builddir) > Makefile

clean:
	-rm $(targetdir)/grps.php grpentry-body.php $(targetdir)/grpentry.php \
		$(targetdir)/mailings.php $(targetdir)/structure.php

$(targetdir)/migdal.conf: $(CONFIGS)
	-mkdir -p $(targetdir)
	cp $(CONFIGS) $(targetdir)

$(targetdir)/grps.php grpentry-body.php: groups.conf ../grpparser
	-mkdir -p $(targetdir)
	../grpparser -C $(targetdir)/grps.php -L grpentry-body.php -p GRP_ \
		-f grp -a grp $<

$(targetdir)/grpentry.php: grpentry-header.php grpentry-body.php grpentry-footer.php
	-mkdir -p $(targetdir)
	cat grpentry-header.php grpentry-body.php grpentry-footer.php > $@

$(targetdir)/mailings.php: mailings.conf ../grpparser
	-mkdir -p $(targetdir)
	../grpparser -C $(targetdir)/mailtypes.php \
		-L $(targetdir)/mailings.php -p MAIL_ -f type_id -a mailing $<

$(targetdir)/structure.php: structure.conf ../structparser
	-mkdir -p $(targetdir)
	../structparser -o $@ $<
