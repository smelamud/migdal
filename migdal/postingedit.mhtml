<< @(#) $Id$ >>

<<
1. Если поле something отсутствует из-за того, что редактор данного типа
   сообщения его не предусматривает, оно должно присутствовать в виде hidden,
   поскольку может присутствовать в других тенях этого же сообщения. В
   противном случае actions/postingmod.php затрет это поле.
2. Все поля должны включаться, если $full!=0.
>>

<grps>
<int name='editid'>
<int name='topic_id'>
<int name='grp'>
<int name='up'>
<int name='full'>
<int name='noguests'>
<<posting_obj id='$editid' grp='$grp' topic_id='$topic_id' up='$up'
             fields='*SELECT_GENERAL'>
<identify posting='$message'>>
<require name='lib/postings.php'>
<?php $posting=new Posting(array('grp' => GRP_FORUMS)); ?>

<macro name='full'>
 <if what='$$full'>
</macro>
<endif name='/full'>

<full>
 <assign name='root' value='-1'>
<else>
 <if what='$topic_id<=0'>
  <assign name='root' value='$`general`'>
 <else>
  <assign name='root' value='$message.RootId'>
 </if>
</full>

<element name='editor_line' params='posting,editor,visible'>
<assign name='ident' value='$editor.Ident'>
<if what="$ident=='' || $ident[0]=='_'">
 <if what='$visible'>
  <form_section title='$=editor.Title'>
 </if>
<elif what="$ident=='priority'">
 <if what='$visible'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment' name='priority'
             value='$posting.Priority' size=4 maxlength=3
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='priority' value='$editor.Priority'>
 </if>
<elif what="$ident=='topic'">
 <if what='$visible'>
  <form_topicselect title='$=editor.Title' comment='$=editor.Comment'
                    name='topic_id' value='$posting.TopicId' grp='$$grp'
	            mandatory='$editor.isMandatory' root='$$root'
	            recursive='*true'>
 <else>
  <hidden name='topic_id' value='$posting.TopicId'>
 </if>
<elif what="$ident=='ident'">
 <if what='$visible'>
  <error id='*EP_IDENT_ABSENT' text='Обозначение не указано'>
  <error id='*EP_IDENT_UNIQUE' text='Так уже обозначено другое сообщение'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment' name='ident'
             value='$posting.Ident' size=15 maxlength=15
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='ident' value='$posting.Ident'>
 </if>
<elif what="$ident=='subject'">
 <if what='$visible'>
  <error id='*EP_SUBJECT_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment'
             value='$=posting.Subject' name='subject' size=70 maxlength=250
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='subject' value='$=posting.Subject'>
 </if>
<elif what="$ident=='author'">
 <if what='$visible'>
  <error id='*EP_AUTHOR_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment'
             value='$=posting.Author' name='author' size=52 maxlength=250
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='author' value='$=posting.Author'>
 </if>
<elif what="$ident=='source'">
 <if what='$visible'>
  <error id='*EP_SOURCE_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment'
             value='$=posting.Source' name='source' size=52 maxlength=250
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='source' value='$=posting.Source'>
 </if>
<elif what="$ident=='comment0'">
 <if what='$visible'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment'
             value='$=posting.Comment0' name='comment0' size=52 maxlength=250
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='comment0' value='$=posting.Comment0'>
 </if>
<elif what="$ident=='body'">
 <if what='$visible'>
  <error id='*EP_BODY_ABSENT' text='Текст пуст'>
  <form_editor title='$=editor.Title' comment='$=editor.Comment'
               name='body' body='$=posting.Body' rows=11
	       mandatory='$editor.isMandatory'>
 <else>
  <hidden name='body' value='$=posting.Body'>
 </if>
<elif what="$ident=='index1'">
 <if what='$visible'>
  <error id='*EP_INDEX1_ABSENT' text#='$=editor.Title не указан'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment'
             value='$posting.Index1' name='index1' size=3 maxlength=5
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='index1' value='$posting.Index1'>
 </if>
<elif what="$ident=='index2'">
 <if what='$visible'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment'
             value='$posting.Index2' name='index2' size=3 maxlength=5
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='index2' value='$posting.Index2'>
 </if>
<elif what="$ident=='lang'">
 <if what='$visible'>
  <error id='*EP_LANG_ABSENT' text#='$=editor.Title не указан'>
  <form_langselect title='$=editor.Title' comment='$=editor.Comment'
                   value='$posting.Lang' name='lang'
	           mandatory='$editor.isMandatory'>
 <else>
  <hidden name='lang' value='$posting.Lang'>
 </if>
<elif what="$ident=='url'">
 <if what='$visible'>
  <error id='*EP_URL_ABSENT' text#='$=editor.Title не указана'>
  <form_edit title='$=editor.Title' comment='$=editor.Comment'
             value='$=posting.URL' name='url' size=52 maxlength=250
	     mandatory='$editor.isMandatory'>
 <else>
  <hidden name='url' value='$=posting.URL'>
 </if>
<else>
 <form_section title='$ident'>
</if>
</element>

<html>
<preamble>
<body>
 <top ident='index'>
 <<setup>>
 <if what='$editid'>
  <assign name='head' value#='Изменить $posting.GrpWhat'>
 <else>
  <assign name='head' value#='Добавить $posting.GrpWhat'>
 </if>
 <form_table title='$head'>
  <form method=post enctype='multipart/form-data'
	action='actions/postingmod.php'>
   <hidden name='edittag' value=1>
   <hidden name='okdir' value='$--'>
   <hidden name='faildir' value='$-'>
   <hidden name='editid' value='$editid'>
   <hidden name='person_id' value='$posting.PersonId'>
   <hidden name='up' value='$posting.UpValue'>
   <starinfo>
   <error id='*EP_NO_EDIT' text='У вас нет права редактировать это сообщение'>
   <error id='*EP_NO_PERSONAL'
	  text='У этого пользователя нет персональной страницы'>
   <error id='*EP_INVALID_GRP' text='Такого типа сообщения не существует'>
   <error id='*EP_TOPIC_ABSENT' text='Тема должна быть выбрана'>
   <error id='*EP_NO_TOPIC' text='Такой темы не существует'>
   <error id='*EP_TOPIC_ACCESS'
	  text='Вы не имеете права добавлять сообщения по этой теме'>
   <error id='*EP_NO_UP' text='Вышестоящего сообщения не существует'>
   <error id='*EP_LOOP_UP' text='Сообщение не может быть подчиненным себе'>
   <error id='*EP_UP_APPEND'
	  text='Вы не имеете права присоединять сообщения к этому сообщению'>
   <<if what='!$editid'>
    <relogin title='$message.GrpItemTitle' noguests='$noguests'>
   </if>
   <moderator>
    <tr><td><table><tr valign=center>
     <full>
      <td><image src='pics/down.gif' border=0></td>
      <td><a href='$[full=0]'>Свернуть</a></td>
     <else>
      <td><image src='pics/right.gif' border=0></td>
      <td><a href='$[full=1]'>Развернуть</a></td>
     </full>
    </tr></table></td></tr>
   </moderator>
   <tr><td><table>>
    <full>
     <form_grpselect title='Группа' mandatory='*true' name='grp'
                     value='$posting.Grp'>
    <else>
     <hidden name='grp' value='$posting.Grp'>
    </full>
    <iterate_grp_editor grp!='!$full ? $posting.Grp : *GRP_NONE'>
    <for>
     <editor_line posting='$posting' editor='$.' visible='*true'>
    </for>
    <<if what='$message.hasImage || $full'>
     <error id='*EP_IMAGE_ABSENT' span=2
	    text='Нужно указать картинку для отображения'>
     <error id='*EP_NO_IMAGE' text='Указанной картинки не существует' span=2>
     <error id='*EIU_UNKNOWN_IMAGE' text='Неизвестный формат картинки' span=2>
     <error id='*EIU_IMAGE_LARGE' text='Картинка слишком велика (больше 2M)'
	    span=2>
     <error id='*EIU_UNKNOWN_THUMBNAIL' span=2
	    text='Формат маленькой картинки, указанный при конфигурации сервера, не поддерживается'>
     <ifnzero what='$message.ImageSet'>
      <image_name set='$message.ImageSet'>
      <assign name='file' value='$image.Filename'>
     <else>
      <assign name='file' value=''>
     </ifnzero>
     <if what='$message.hasLargeBody'>
      <assign name='ititle' value='Картинка<br>для аннотации'>
     <else>
      <assign name='ititle' value='Картинка'>
     </if>
     <uploader name='image' loadedname='image_set'
	       loadedvalue='$message.ImageSet' title='$ititle'
	       loaded='(уже загружена)' notloaded='Другая' filename='$file'
	       mandatory='$message.mandatoryImage'>
     <if what='$message.hasTitle || $full'>
      <ifnzero what='$message.ImageSet'>
       <assign name='ttext' value='$image.Title'>
      <else>
       <assign name='ttext' value=''>
      </ifnzero>
      <editor_line name='title' body='$ttext' title='Подпись под картинкой'
		   rows=4 span=2 mandatory='$message.mandatoryTitle'>
     <else>
      <ifnzero what='$message.ImageSet'>
       <hidden name='title' value='$image.Title'>
      </ifnzero>
     </if>
    <else>
     <ifnzero what='$message.ImageSet'>
      <hidden name='image_set' value='$message.ImageSet'>
      <image_name set='$message.ImageSet'>
      <hidden name='title' value='$,Title'>
     </ifnzero>
    </if>
   <if what='$message.hasLargeBody || $full'>
    <error id='*EP_LARGE_BODY_ABSENT' text='А где сама статья?'>
    <error id='*EUL_LARGE' text='Статья слишком велика (больше 2M)'>
    <ifne what='$message.LargeFilename'>
     <tr><td colspan=2>
      <a href='/lib/plain.php/migdal-$message.StotextId.txt?id=$message.StotextId&win=1'>
	 Текст в кодировке win</a>
      &nbsp;
      <a href='/lib/plain.php/migdal-$message.StotextId.txt?id=$message.StotextId'>
	 Текст в кодировке koi</a>
     </td></tr>
    </ifne>
    <uploader name='large_file' loadedname='large_loaded' loadedvalue=1
	      title='Текст' loaded='(уже загружен)' notloaded='Другой'
	      filename='$message.LargeFilename'
	      mandatory='$message.mandatoryLargeBody'>
    <upload_format format='$message.LargeFormat'>
    <help_link href='stotext-help-types.php'
	       title='Какой формат статьи выбрать?' span=2>
    </table></td></tr>
   <else>
    </table></td></tr>
    <ifne what='$message.LargeFilename'>
     <hidden name='large_loaded' value=1>
    </ifne>
   </if>>
   <moderator>
    <assign name='who' value='автору'>
   <else>
    <assign name='who' value='мне'>
   </moderator>
   <logged>
    <form_select title='Видимость' name='hidden' style='box'>
     <form_option title='Сообщение видно всем пользователям' value='0'
                  selected!='!$posting.isHidden'>
     <form_option title#='Сообщение видно только $who и модераторам' value='1'
                  selected='$posting.isHidden'>
    </form_select>
   <else>
    <hidden name='hidden' value='0'>
   </logged>
   <full>
    <form_select title='Запретить показ'
                 comment='Модераторский запрет на показ сообщения. Пользователь
		          не может снять этот запрет'
		 name='disabled' style='box'>
     <form_option title='Нет запрета на показ всем пользователям' value='0'
                  selected!='!$posting.isDisabled'>
     <form_option title#='Разрешено показывать только $who и модераторам'
                  value='1' selected='$posting.isDisabled'>
    </form_select>
   <else>
    <hidden name='disabled' value='$posting.isDisabled'>
   </full>
   <if what='$editid'>
    <form_buttons title='Изменить'>
   <else>
    <form_buttons title='Добавить'>
   </if>
  </form>
 </form_table>
 <bottom>
</body>
</html>
