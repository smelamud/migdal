<< @(#) $Id$ >>

<macro name='trace'>
 <backtrace_url url%!url='%url' target='$target' isbottom='*false'>
</macro>

<element name='backtrace_url' params='url,target,isbottom,&name'
         defaults="isbottom='*true' name='$name'">
<parse_url url='$url'>
<if what="$basename=='archive.php'">
 <trace url='index.php'>
 <assign name='name' value='Архив'>
<elif what="$basename=='article.php'">
 <posting_obj id='$artid'>
 <identify posting='$,'>
 <trace url='$,GeneralHref'>
 <assign name='name' value='$,Subject'>
<elif what="$basename=='article-times.php'">
 <posting_obj id='$artid'>
 <trace url#='times.php?issue=$,Index1'>
 <assign name='name' value='$,Subject'>
<elif what="$basename=='book-chapter.php'">
 <posting_obj name='book' id='$chapid'>
 <message_posting id='$,UpValue'>
 <posting_obj name='chap' id='$,'>
 <trace url#='book.php?bookid=$book.Id'>
 <assign name='name' value='$chap.Subject'>
<elif what="$basename=='book.php'">
 <posting_obj id='$bookid'>
 <identify posting='$,'>
 <trace url='$,GeneralHref'>
 <assign name='name' value='$,Subject'>
<elif what="$basename=='event.php'">
 <topic_obj id='$topic_id'>
 <trace url='migdal-news.php'>
 <assign name='name' value='$,Name'>
<elif what="$basename=='forumcatalog.php'">
 <assign name='name' value='Обсуждения'>
<elif what="$basename=='forum.php'">
 <posting_obj id='$msgid'>
 <trace url#='$,DetailsFile?$,DetailsId=$,Id'>
 <assign name='name' value='Обсуждение'>
<elif what="$basename=='gallery.php'">
 <if what='$topic_id<=0'>
  <assign name='name' value='Галерея'>
 <else>
  <topic_obj name='topic' id='$topic_id'>
  <if what='$user_id<=0'>
   <if what='!$general'>
    <if what='$/$topic_id,0/!=$`migdal` || $topic_id==$`migdal`'>
     <trace url='gallery.php'>
    <else>
     <trace url#='gallery.php?topic_id=$`migdal`'>
    </if>
   <else>
    <if what='$topic_id==$`kes`'>
     <trace url#='migdal.php?artid=$`postings:kes`'>
     <assign name='name' value='Галерея'>
    <elif what='$topic_id==$`mazltov`'>
     <trace url#='migdal.php?artid=$`postings:mazltov`'>
     <assign name='name' value='Галерея'>
    <elif what='$topic_id==$`migdal-ohr`'>
     <trace url#='migdal.php?artid=$`postings:migdal-ohr`'>
     <assign name='name' value='Галерея'>
    </if>
   </if>
   <assign name='name' value#='$,Name'>
  <else>
   <trace url#='gallery.php?topic_id=$topic_id'>
   <user_obj id='$user_id'>
   <assign name='name' value#='$,FullName'>
  </if>
 </if>
<elif what="$basename=='index.php'">
 <if what='$topic_id<=0'>
  <notenglish>
   <assign name='name' value='Главная'>
  <else>
   <assign name='name' value='Home'>
  </notenglish>
 <else>
  <topic_obj id='$topic_id'>
  <trace url='index.php'>
  <assign name='name' value='$,Name'>
 </if>
<elif what="$basename=='jcc.php'">
 <trace url='migdal.php'>
 <assign name='name' value='Общинный центр (JCC)'>
<elif what="$basename=='kaitana-main.php'">
 <trace url='jcc.php'>
 <assign name='name' value='Дневные детские лагеря'>
<elif what="$basename=='kaitana.php'">
 <topic_obj id='$topic_id'>
 <if what='$day<=0 && $postid<=0'>
  <trace url='kaitana-main.php'>
  <assign name='name' value='$,Name'>
 <else>
  <if what='$postid<=0'>
   <posting_obj name='posting' topic_id='$,Id' index1='$day'>
  <else>
   <posting_obj name='posting' id='$postid'>
  </if>
  <trace url#='kaitana.php?topic_id=$posting.TopicId'>
  <assign name='name' value='$posting.Subject'>
 </if>
<elif what="$basename=='methodic-center.php'">
 <trace url='migdal.php'>
 <assign name='name' value='Методический центр'>
<elif what="$basename=='methodics.php'">
 <trace url='methodic-center.php'>
 <assign name='name' value='Методические пособия'>
<elif what="$basename=='migdal.php'">
 <if what='$artid<=0 || $artid==$`postings:migdal`'>
  <trace url='index.php'>
  <assign name='name' value='Мигдаль'>
 <else>
  <posting_obj name='posting' id='$artid'>
  <if what='$/$posting.TopicId,1/==$`jcc` || $,TopicId!=$`jcc`'>
   <trace url='jcc.php'>
  <else>
   <trace url='migdal.php'>
  </if>
  <assign name='name' value='$,Subject'>
 </if>
<elif what="$basename=='migdal-library.php'">
 <trace url='migdal.php'>
 <assign name='name' value='Библиотека'>
<elif what="$basename=='migdal-library-news.php'">
 <trace url='migdal-library.php'>
 <assign name='name' value='Новые поступления'>
<elif what="$basename=='migdal-news.php'">
 <if what='$topic_id<=0'>
  <trace url='migdal.php'>
 <else>
  <if what='$topic_id==$`mazltov-news`'>
   <trace url#='migdal.php?artid=$`postings:mazltov`'>
  <elif what='$topic_id==$`museum-news`'>
   <trace url#='migdal.php?artid=$`postings:museum`'>
  </if>
 </if>
 <assign name='name' value='Новости'>
<elif what="$basename=='posting.php'">
 <posting_obj id='$postid'>
 <identify posting='$,'>
 <trace url='$,GeneralHref'>
 <assign name='name' value='$,SubjectDesc'>
<elif what="$basename=='printings.php'">
 <trace url='migdal.php'>
 <assign name='name' value='Издательский центр'>
<elif what="$basename=='taglit.php'">
 <trace url='index.php'>
 <assign name='name' value='Таглит'>
<elif what="$basename=='taglit-user.php'">
 <user_obj id='$user_id'>
 <trace url='taglit.php'>
 <assign name='name' value='$,FullName'>
<elif what="$basename=='times.php'">
 <assign name='name' value#='&lt;&lt;Мигдаль Times&gt;&gt; No.$issue'>
<elif what="$basename=='userinfo.php'">
 <user_obj id='$id'>
 <trace url='users.php'>
 <assign name='name' value='$,Login'>
<elif what="$basename=='users.php'">
 <assign name='name' value='Пользователи'>
<elif what="$basename=='veterans.php'">
 <trace url='index.php'>
 <assign name='name' value='Уголок ветерана'>
<elif what="$basename=='veterans-user.php'">
 <user_obj id='$user_id'>
 <trace url='veterans.php'>
 <assign name='name' value='$,FullName'>
</if>
<if what='!$isbottom'>
 <nobr><at href='$url' target='$target'>$name</at>&sp;&gt;</nobr>
</if>
</element>

<element name='backtrace'>
<iterate_redirs name='redirs'>
<outer>
 <div class='return'>
  <for>
   <assign name='name' value='$.Name'>
   <isfirst what='$redirs'>
    <inner>
    <backtrace_url url='$.URI' target='$target'>
   </isfirst>
   <islast what='$redirs'>
    </inner>
    <nobr>$name</nobr>
   <else>
    <nobr><at href='$.URI' target='$target'>$name</at>&sp;&gt;</nobr>
   </islast>
  </for>
 </div>
</outer>
</element>
