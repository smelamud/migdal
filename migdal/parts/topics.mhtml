<< @(#) $Id$ >>
<< Based-on: demo/parts/topics.mhtml 1.5 >>

<macro name='grayed' defaults="link='index.php'">
 <ifnzero what='$topic.Allow & *GRP_%^group'>
  <if what='$g.Effective==*GRP_%^group'>
   <image src='pics/%file.gif' title='%title'>&nbsp;
  <else>
   <a href='%link?grp=*GRP_%^group&topic_id=$topic_id'><asp>
    <image border=0 src='pics/%{file}-gray.gif' title='%title'></a>&nbsp;
  </if>
 <else>
  <a href='%link?grp=*GRP_%^group&topic_id=-1'><asp>
   <image border=0 src='pics/%{file}-gray.gif' title='%title'></a>&nbsp;
 </ifnzero>
</macro>

<macro name='arrow'>
 <td>
  <if what='$topic_id==%id'>
   <ifbiff time='%time'>
    <image src='$$style_topics_ner_arrow' title='новое'>
   <else>
    <image src='$$style_topics_arrow'>
   </ifbiff>
  <else>
   <ifbiff time='%time'>
    <image src='pics/ner.gif' title='новое'>
   <else>
    &nbsp;
   </ifbiff>
  </if>
 </td>
</macro>

<element name='topics'>
<topic_obj id='$topic_id'>
<iterate_topiclist grp='$g.Effective' withpostings='$withpostings'
                   withanswers='$withanswers'>
<if what='$navi'>
 <grayed group='tape' file='all' title='Все'>
 <grayed group='news' file='new' title='Новости'>
 <grayed group='forums' file='opinion' title='Мнения'>
 <grayed group='articles' file='article' title='Статьи'>
 <zone>
  <posting_last grp='*GRP_GALLERY'>
  <ifbiff time='$,'>
   <grayed group='gallery' file='gall-ner' link='gallery.php'
	   title='Галерея (новое)'>
  <else>
   <grayed group='gallery' file='gall' link='gallery.php' title='Галерея'>
  </ifbiff>
 </zone>
</if>
<if what='$$userAdminTopics || $;Count!=0'>
 <table class='topics' width=100%>
  <col width=0*>
  <admin_topics>
   <tr class='controls'><td colspan=2>
    <a href='topicedit.php?redir=$_'>Добавить</a>
   </td></tr>
  </admin_topics>
  <tbody class='names'>
   <tr>
    <arrow id='-1'>
    <td><a href='$file?grp=$g.Grp&topic_id=-1' class='new'>Все темы</a></td>
   </tr>
   <for>
    <tr>
     <arrow id='$.Id' time='$.LastMessage'>
     <td>
      <a href='$file?grp=$g.Grp&topic_id=$.Id' title='$.Description'>
	 $.Name&nbsp;<span class='answers'>($.MessageCount)</span></a>
      <admin_topics>
       <br>
       <a href='topicedit.php?editid=$.Id&redir=$_' class='edit'>Изменить</a>
      </admin_topics>
     </td>
    </tr>
   </for>
  </tbody>
 </table>
</if>
</element>
