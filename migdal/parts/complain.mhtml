<< @(#) $Id$ >>

<element name='complain_assign' params='complain'>
<judge>
 <assign name='info' value='$complain.PersonInfo'>
 <table cellspacing=0 cellpadding=0><tr>
  <form method=post action='actions/complainassign.php'>
   <hidden name='okdir' value='$-'>
   <hidden name='faildir' value='$-'>
   <hidden name='id' value='$complain.Id'>
   <td>Рассматривает:</td>
   <td>&nbsp;</td>
   <ifnzero what='$complain.PersonId'>
    <td class='name'>$info.Login</td>
    <td>&nbsp;</td>
   </ifnzero>
   <td><edit name='login' value='$info.Login' size=8 maxlength=30></td>
   <td><input type=submit value='Назначить'></td>
  </form>
 </tr></table>
<else>
 Рассматривает:
 <ifnzero what='$complain.PersonId'>
  <senderlink message='$info'>
 <else>
  Никто
 </ifnzero>
</judge>
</element>

<element name='answerselect' params='complain'>
<<td><table>
 <tr>
  <form method=get action='complainanswer.php'>
   <hidden name='redirid' value='$_'>
   <hidden name='complain_id' value='$complain.Id'>
   <td><select name='actid'>
    <iterate_complain_actionlist type='$complain.TypeId'>
    <for>
     <if what='$.isAutomatic'>
      <option value='$.Id' selected>$.Name
     <else>
      <option value='$.Id'>$.Name
     </if>
    </for>
   </select></td>
   <td><input type=submit value='Ответить'></td>
  </form> 
  <admin_complain_answers>
   <td>
    <a href='complainactionedit.php?typeid=$complain.TypeId&redirid=$_'
       >Редактировать&nbsp;список&nbsp;&gt;&#x3e;&gt;</a>
   </td>
  </admin_complain_answers>
 </tr>
 <ifnzero what='$complain.Deadline'>
  <tr>
   <td colspan=2>
    <if what='$complain.isNoAuto'>
     <a href='actions/complainauto.php?id=$complain.Id&no_auto=0&okdir=$#-&faildir=$#-'
	>Рассматривать автоматически</a>
    <else>
     <a href='actions/complainauto.php?id=$complain.Id&no_auto=1&okdir=$#-&faildir=$#-'
	>Не рассматривать автоматически</a>
    </if>
   </td>
  </tr>
 </ifnzero>
</table></td>>
</element>

<element name='complain'>
<table width=100% class='complains' cellspacing=0 cellpadding=0><tr><td>
 <table width=100% class='complain' cellspacing=1>
  <error id='*EC_NO_ASSIGN' span=3
	 text='Вы не имеете права направлять жалобы на рассмотрение'>
  <error id='*EC_NO_COMPLAIN' text='Такой жалобы не существует' span=3>
  <error id='*EC_LOGIN_ASSIGN' text='Такой пользователь не зарегистрирован'
	 span=3>
  <error id='*EC_NO_AUTO' span=3
	 text='Вы не имеете права управлять автоматическим рассмотрением жалобы'>
  <tr>
   <td width=200 class='eightpt'>Автор: <senderlink message='$complain'></td>
   <td rowspan=2 class='subject'>
    <biff time='$complain.Sent'>$=complain.Subject
   </td>
   <td width=200 class='eightpt'><complain_assign complain='$complain'></td>
  </tr>
  <tr>
   <td width=200 class='eightpt'>Послано: <sentview date='$complain.Sent'></td>
   <td width=200 class='eightpt'>
    <if what='$complain.isClosed'><b>Жалоба закрыта</b><else>&nbsp;</if>
   </td>
  </tr>
  <ifne what='$complain.Body'>
   <tr valign=top><td align=left class='ninept' colspan=3>
    $complain.BodyHTML
   </td></tr>
  </ifne>
  <if what='$complain.isWritable || $discuss || $$userId==$complain.PersonId
            || $$adminComplainAnswers'>
   <tr class='eightpt'><td colspan=3><table width=100%><tr>
    <if what='$$userId==$complain.PersonId || $$adminComplainAnswers'>
     <answerselect complain='$complain'> 
    </if>
    <iswrite what='$complain'>
     <td>
      <a href='complainedit.php?editid=$complain.Id&redirid=$_'>Изменить</a>
     </td>
    </iswrite>
    <if what='$discuss'>
     <td align=right>
      <a href='/complains/$complain.Id/?redirid=$_'><asp>
       <asp>Обсудить ($complain.Answers)<asp>
      <asp></a>
     </td>
    </if>
   </tr></table></td></tr>
  </if>
 </table>
</td></tr></table>
</element>
