<< @(#) $Id$ >>
<< Based-on: migdal/parts/postings.mhtml 1.11 >>

<element name='batcher_forumcatalog' params='value,list,topic,grp'>
<grpdata>
<grpitemtitle>
<table width=100% class='batcher'>
 <form method=get action='$~'>
  <hiddenget remove='fcp'>
  <tr>
   <td align=left><table><tr valign=bottom><td>
    <logged>
     <if what='$g.Valid'>
      <a href='postingedit.php?topic_id=$topic&grp=$grp&redir=$_'
         class='add'>Добавить $grpitemtitle</a>
     <else>
      <a href='postingedit.php?topic_id=$topic&grp=*GRP_NEWS&redir=$_'
         class='add'>Добавить новость</a>
      </td><td width=10></td><td>
      <a href='postingedit.php?topic_id=$topic&grp=*GRP_ARTICLES&redir=$_'
         class='add'>Добавить статью</a>
     </if>
    </logged>
   </td></tr></table></td>
   <td align=right><table><tr valign=center>
    <td><input type=submit value='Показывать'></td>
    <td>по</td>
    <td>
     <select_portion name='fcp' value='$value' vals='10 15 20 25 30 35 40'>
    </td>
    <td>из&nbsp;$list.Size&nbsp;<asp><ofmessages value='$list.Size'></td>
    <if what='$list.Size>$list.Limit'>
     <form method=post action='actions/goto.php'>
      <hidden name='redir' value='$-'>
      <hidden name='size' value='$list.Size'>
      <td align=right width=32>
       <ifnzero what='$list.Offset'>
	<a href="$[offset='$list.PrevOffset']" title='Предыдущие'>
	 <img src='pics/left.gif' border=0></a>
       </ifzero>
      </td>
      <td align=right>
       <edit name='value' value='$list.BeginValue' size=2 maxlength=5>
      </td>
      <td align=center>-</td>
      <td align=right>
       $list.EndValue
      </td>
      <td align=left width=32>
       <if what='$list.EndValue<$list.Size'>
	<a href="$[offset='$list.NextOffset']" title='Следующие'>
	 <img src='pics/right.gif' border=0></a>
       </if>
      </td>
     </form>
    </if>
   </tr></table></td>
  </tr>
 </form>
</table>
</element>

<element name='ForumCatalog'>
<iterate_postinglist grp='$grp' topic='$topic' limit='$limit' offset='$offset'
                     sort='*SORT_PSENT'>
<if what='$$userId>0 || $;Count!=0'>
 <batcher_forumcatalog value='$limit' list='$;' topic='$topic' grp='$grp'>
 <table>
  <error id='*EMH_NO_MESSAGE' text='Такого сообщения не существует'>
  <error id='*EMH_NO_MODERATE' text='Вы не модератор'>
 </table>
 <table width=100% class='forumcatalog'>
  <tr>
   <if what='$topic<0'>
    <th>Раздел</th>
   </if>
   <th>Тема</th><th colspan=2>Начало / Последнее сообщение</th>
   <th class='answer'>Ответы</th>
  </tr>
  <for>
   <if what='$;isOdd'><tr class='odd'><else><tr></if>
    <if what='$topic<0'>
     <td class='topic' rowspan=2>
      <a href='forumcatalog.php?redir=$_&grp=$grp&topic_id=$.TopicId'
	 class='topic' title='$.TopicDescription'>$.TopicName</a>
     </td>
    </if>
    <td class='subject' rowspan=2>
     <a href='forum.php?redir=$_&msgid=$.Id'>$.Subject</a>
    </td>
    <td>
     <if what='$.isRebe'>
      <span class='rebe'>
     </if>
     <senderlink message='$.'>
     <if what='$.isRebe'>
      </span>
     </if>
    </td>
    <td><sentview date='$.Sent'></td>
    <td class='answer' rowspan=2>
     <a href='forum.php?redir=$_&msgid=$.Id'>$.AnswerCount</a>
    </td>
   </tr>
   <if what='$;isOdd'><tr class='odd'><else><tr></if>
    <ifnzero what='$.LastAnswer'>
     <zone>
      <forum_answer_author up='$.MessageId' sent='$.LastAnswer'>
      <td>
       <if what='$.isRebe'>
	<span class='rebe'>
       </if>
       <senderlink message='$,'>
       <if what='$.isRebe'>
	</span>
       </if>
      </td>
     </zone>
     <td><sentview date='$.LastAnswer'></td>
    <else>
     <td>&nbsp;</td><td>&nbsp;</td>
    </ifnzero>
   </tr>
  </for>
 </table>
 <ifnzero what='$;Count'>
  <batcher_forumcatalog value='$limit' list='$;' topic='$topic' grp='$grp'>
 </ifnzero>
<else>
 &nbsp;
</if>
</element>
