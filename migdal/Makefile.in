# Makefile for Migdal website

# @(#) $Id$

targetdir=$(builddir)/www/

OBJECTS = 404.mhtml 500.mhtml archive.mhtml article.mhtml article-times.mhtml \
	  book.mhtml book-chapter.mhtml book-chapter-split.mhtml \
	  book-print.mhtml book-split.mhtml book-static.mhtml chat.mhtml \
	  chatboard.mhtml chatbottom.mhtml chatconsole.mhtml chattop.mhtml \
	  chatusers.mhtml chmod.mhtml complainactionedit.mhtml \
	  complainanswer.mhtml complainedit.mhtml complainforum.mhtml \
	  complains.mhtml cross-entries.mhtml cross-entry-add.mhtml \
	  daily-news.mhtml ears.mhtml event.mhtml events.mhtml \
	  events-english.mhtml forum.mhtml forumedit.mhtml forumcatalog.mhtml \
	  gallery.mhtml gallery-main.mhtml groupadd.mhtml grouporg.mhtml \
	  halom-main.mhtml help.mhtml horisontedit.mhtml index-english.mhtml \
	  index-www.mhtml jcc.mhtml journal.mhtml kaitana-main.mhtml \
	  limedit.mhtml liminsert.mhtml link.mhtml links.mhtml \
	  methodic-center.mhtml methodics.mhtml migdal.mhtml \
	  migdal-library.mhtml migdal-library-novelties.mhtml \
	  migdal-news.mhtml modbits.mhtml moderator.mhtml peruser.mhtml \
	  peruser-user.mhtml posting.mhtml postingedit.mhtml postingorg.mhtml \
	  printings.mhtml rating.mhtml register.mhtml reorder.mhtml \
	  search.mhtml stotext-help-subs.mhtml stotext-help-types.mhtml \
	  style.mhtml times.mhtml tips.mhtml topicdel.mhtml topicedit.mhtml \
	  topicorg.mhtml urls.mhtml useredit.mhtml userfin.mhtml \
	  userinfo.mhtml userinfo-panel.mhtml userlost.mhtml userok.mhtml \
	  userrepair.mhtml users.mhtml
	  
$(targetdir):
	mkdir -p $(targetdir)

$(targetdir)/%.php: %.mhtml $(targetdir) ../miparser ../macros.mhtml macros.mhtml
	../miparser -M ../macros.mhtml -M macros.mhtml $< > $@

all: $(OBJECTS:%.mhtml=$(targetdir)/%.php)
	-mkdir -p $(targetdir)
	-mkdir -p $(targetdir)/books
	-mkdir -p $(targetdir)/images
	cp favicon.ico dispatcher.php .htaccess robots.txt *.js $(targetdir)
	(cd grp; $(MAKE) all)
	(cd parts; $(MAKE) all)
	(cd pics; $(MAKE) all)
	(cd styles; $(MAKE) all)
	(cd mailings; $(MAKE) all)

Makefile: Makefile.in ../conf/migdal.conf
	../confmake $^ $(builddir) > Makefile

dbinfo:
	echo > migdal.db

clean:
	(cd grp; $(MAKE) clean)
	(cd styles; $(MAKE) clean)
