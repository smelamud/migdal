# Makefile for Migdal website

# @(#) $Id$

FLAVOURS = default old contrast test
STYLE_PARTS = colors.mcss fonts.mcss palette.mcss sheet-general.mcss \
	sheet-menu.mcss sheet-bottom.mcss sheet-state.mcss sheet-return.mcss \
	sheet-batcher.mcss sheet-posting.mcss sheet-forum.mcss \
	sheet-forum-batcher.mcss sheet-topics.mcss sheet-catalog.mcss \
	sheet-picture.mcss sheet-form.mcss sheet-userinfo.mcss
ARTICLE_PARTS = colors.mcss fonts.mcss palette.mcss sheet-article.mcss
COMPLAIN_PARTS = colors.mcss fonts.mcss palette.mcss sheet-complain.mcss
CHAT_PARTS = colors.mcss fonts.mcss palette.mcss sheet-chat.mcss
TIMES_PARTS = colors.mcss fonts.mcss palette.mcss sheet-times.mcss
VOTES_PARTS = colors.mcss fonts.mcss palette.mcss sheet-votes.mcss

style-%.php: style.mcss $(STYLE_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

style-%.css: style.mcss $(STYLE_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

style.stamp: $(patsubst %,style-%.css,$(FLAVOURS)) $(patsubst %,style-%.php,$(FLAVOURS))
	touch $@

article-%.php: article.mcss $(ARTICLE_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

article-%.css: article.mcss $(ARTICLE_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

article.stamp: $(patsubst %,article-%.css,$(FLAVOURS)) $(patsubst %,article-%.php,$(FLAVOURS))
	touch $@

complain-%.php: complain.mcss $(COMPLAIN_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

complain-%.css: complain.mcss $(COMPLAIN_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

complain.stamp: $(patsubst %,complain-%.css,$(FLAVOURS)) $(patsubst %,complain-%.php,$(FLAVOURS))
	touch $@

chat-%.php: chat.mcss $(CHAT_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

chat-%.css: chat.mcss $(CHAT_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

chat.stamp: $(patsubst %,chat-%.css,$(FLAVOURS)) $(patsubst %,chat-%.php,$(FLAVOURS))
	touch $@

times-%.php: times.mcss $(TIMES_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

times-%.css: times.mcss $(TIMES_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

times.stamp: $(patsubst %,times-%.css,$(FLAVOURS)) $(patsubst %,times-%.php,$(FLAVOURS))
	touch $@

votes-%.php: votes.mcss $(VOTES_PARTS) ../../cssparser
	../../cssparser -p -s $* $< > $@

votes-%.css: votes.mcss $(VOTES_PARTS) ../../cssparser
	../../cssparser -s $* $< > $@

votes.stamp: $(patsubst %,votes-%.css,$(FLAVOURS)) $(patsubst %,votes-%.php,$(FLAVOURS))
	touch $@

all: style.stamp article.stamp complain.stamp chat.stamp times.stamp votes.stamp

Makefile: Makefile.in ../../conf/migdal.conf
	../../confmake $^ > Makefile

clean:
	-rm $(OBJECTS)
