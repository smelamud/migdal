# Makefile for GRP definitions

# @(#) $Id$

targetdir=$(builddir)/www/grp/

all: groups.stamp mailings.stamp complains.stamp structure.stamp
	cp .htaccess counters.php subdomains.php titles.php scripts.php \
		traps.php cross-entries.php forums.php $(targetdir)

Makefile: Makefile.in ../../conf/migdal.conf
	../../confmake $^ $(builddir) > Makefile

clean:
	-rm *.stamp
	-rm grpentry-body.php

groups.stamp: groups.conf ../../grpparser
	-mkdir -p $(targetdir)
	../../grpparser -C $(targetdir)/grps.php -L grpentry-body.php -p GRP_ \
		-f grp -a grp $<
	cat grpentry-header.php grpentry-body.php grpentry-footer.php \
		> $(targetdir)/grpentry.php
	touch $@

mailings.stamp: mailings.conf ../../grpparser
	-mkdir -p $(targetdir)
	../../grpparser -C $(targetdir)/mailtypes.php \
		-L $(targetdir)/mailings.php -p MAIL_ -f type_id -a mailing $<
	touch $@

complains.stamp: complains.conf ../../grpparser
	-mkdir -p $(targetdir)
	../../grpparser -C $(targetdir)/compltypes.php \
		-L $(targetdir)/complains.php -p COMPL_ -f type_id \
		-a complain $<
	touch $@

structure.stamp: structure.conf ../../structparser
	-mkdir -p $(targetdir)
	../../structparser -o $(targetdir)/structure.php $<
	touch $@
