<< @(#) $Id$ >>

<grps>
<int_array name='topic_id'>
<int name='offset'>
<int name='grp'>
<assign name='grp' value!='$grp>0 ? $grp : ($grp==0 ? *GRP_TAPE : 0)'>
<int name='index1'>
<int name='use_index1'>

<pagetitle title='Сообщения'>
<topictitle title='Сообщения'>

<element name='batcher' params='&list'>
<table width=100%><tr valign=bottom>
 <td align=left class='info'>
  <table><tr valign=center>
   <td><image src='pics/sheet.gif'></td>
   <td>
    <a href='postingedit.php?grp=*GRP_NEWS&full=1&redirid=$_'
       >Добавить сообщение</a>
   </td>
  </tr></table>
 </td>
 <td align=center><spin list='$list'></td>
</tr></table>
</element>

<element name='error_lines'>
<if what='$$err!=0'>
 <table>
  <error id='*EMH_NO_MESSAGE' text='Такого сообщения не существует'>
  <error id='*EMH_NO_MODERATE' text='Вы не модератор'>
  <error id='*EMR_NO_RENEW' text='Вы не модератор'>
  <error id='*EMR_NO_MESSAGE' text='Такого сообщения не существует'>
  <error id='*EMR_SQL' text='Ошибка базы данных при обновлении записи'>
  <error id='*EPD_NO_DELETE' text='Вы не модератор'>
  <error id='*EPD_POSTING_ABSENT' text='Такого сообщения не существует'>
 </table>
</if>
</element>

<element name='post' params='posting'>
<ifnzero what='$posting.Shadow'><blockquote></ifnzero>
 <table class='posting' width=100%>
  <tr><td>
   <iterate_topic_hierarchy topic_id='$posting.TopicId'>
   <span class='subject'>
    <a href='$[topic_id=$posting.TopicId]' title='$posting.TopicDescription'
       class='topic'><asp>
     <for>
      <if what='!$;isFirst'>&sp;::&sp;</if>
      $.Name
     </for>
    <asp></a>
   </span>
   // $posting.GrpTitle
  </td></tr>
  <tr><td>
   <identify posting='$posting'>
   <b><a href='$posting.DetailsHref'>$posting.SubjectDesc</a></b>
   <ifne what='$posting.Ident'>
    [$posting.Ident=$posting.Id]
   <else>
    [$posting.Id]
   </ifne>
  </td></tr>
  <ifnzero what='$posting.VoteCount'>
   <tr><td>
    $posting.VoteString&nbsp;<image src#='pics/bar-${posting.Vote20}.gif'>
    &nbsp;
    <array vals='голос,голоса,голосов'>
    <plural value='$posting.VoteCount'>
    ($posting.VoteCount&sp;$,)
   </td></tr>
  </ifnzero>
  <ifnzero what='$posting.ImageSet'>
   <tr><td>
    <image_link id='$posting.ImageId'>
    $,Картинка</a>
    &nbsp;
    ${posting.ImageX}x${posting.ImageY}, ${posting.ImageSizeKB}KB
   </td></tr>
  </ifnzero>
  <tr><td class='sent'>
   <sentview date='$posting.Sent'>&nbsp;
   <senderlink message='$posting'>
  </td></tr>
  <tr><td class='bottom'>
   <if what='$posting.isHidden'>
    <b>[X]</b>
    &nbsp;
   </if>
   <a href="postingedit.php?editid=$posting.Id&grp=*GRP_ALL&full=1&redirid=$_"
      >Изменить</a>
   &nbsp;
   <if what='$posting.isDisabled'>
    <a href="actions/moderate.php?editid=$posting.MessageId&hide=0&okdir=$#-&faildir=$#-"
       >Разрешить&nbsp;показ</a>
   <else>
    <a href="actions/moderate.php?editid=$posting.MessageId&hide=1&okdir=$#-&faildir=$#-"
       >Запретить&nbsp;показ</a>
   </if>
   &nbsp;
   <a href='actions/shadow.php?postid=$posting.Id&okdir=$#-&faildir=$#-'
      >Тень</a>
   &nbsp;
   <a href="actions/messagerenew.php?id=$posting.MessageId&okdir=$#-&faildir=$#-"
      >Осовременить</a>
   &nbsp;
   <a href="actions/postingdel.php?id=$posting.Id&okdir=$#-&faildir=$#-"
      >Удалить</a>
   &nbsp;
   <a href="chmod.php?msgid=$posting.MessageId&redirid=$_">Права</a>
   &nbsp;
   <a href="modbits.php?postid=$posting.Id&redirid=$_">Флаги</a>
  </td></tr>
 </table>
<ifnzero what='$posting.Shadow'></blockquote></ifnzero>
<p>
</element>

<html>
<preamble>
<body>
 <top ident='index'>
 <iterate_postinglist name='postings' limit=20 offset='$offset'
                      showshadows='*true' grp='$grp'
		      index1!='$use_index1 ? $index1 : -1'>
 <table width=100% cellpadding=5>
  <tr valign=top>
   <td width=150 class='eframe'>
    <topics_admin ident='admin-messages'>
   </td>
   <td style='padding: 0'>
    <table class='ninept nframe' style='padding: 5px'>
     <form method=post action='actions/postingorg-goto.php'>
      <hidden name='okdir' value='$-'>
      <hidden name='faildir' value='$-'>
      <hidden name='redirid' value='$redirid'>
      <tr><td colspan=2>
       <subtitle>
      </td></tr>
      <tr><td align=left colspan=2><table><zone>
       <assign name='title' value='Тема'>
       <iterate_array values='$topic_id'>
       <assign name='n' value=0>
       <for>
	<assign name='id' value!='abs($.)'>
	<assign name='rec' value!='$.<=0'>
	<filter_topic list='$postings' topic_id='$id' recursive='$rec'>
	<topicselect name='topic_id[]' value='$id' title='$title'>
	<tr>
	 <td>&nbsp;</td>
	 <td>
	  <checkbox title='С подтемами' name#='recursive($n)' value='$rec'>
	 </td>
	</tr>
        <assign name='title' value='<i>Или</i>'>
        <assign name='n' value!='$n+1'>
       </for>
       <topicselect name='topic_id[]' value=0 title='$title'>
       <tr>
	<td>&nbsp;</td>
	<td>
	 <checkbox title='С подтемами' name#='recursive($n)' value='*true'>
	</td>
       </tr>
      </zone></table></td></tr>
      <tr><td align=left colspan=2>
       Тип сообщения
      </td></tr>
      <tr valign=top>
       <td align=left>
	<select name='grp[]' size=6 multiple><zone>
	 <iterate_grps>
	 <for>
	  <if what='$.isValid'>
	   <radio title='$.GrpTitle' value='$.Grp' peervalue!='$grp & $.Grp'>
	  </if>
	 </for>
	</zone></select>
       </td>
       <td align=left><table><tr>
        <td><checkbox_button name='use_index1' value='$use_index1'></td>
	<td>Номер </td>
	<td><edit name='index1' value='$index1' size=8 maxlength=8></td>
       </tr></table></td>
      </tr>
      <tr><td align=left colspan=2>
       <table cellspacing=10><tr>
	<td><input type=submit value='Просмотр'></td>
	<td><input type=reset value='Очистить'></td>
       </tr></table>
      </td></tr>
     </form>
     <assign name='size' value='$;Size'>
     <tr><td class='info' colspan=2>
      <array vals='сообщение,сообщения,сообщений'>
      <plural value='$size'>
      Выбрано&nbsp;<em>$size</em>&nbsp;$,
     </td></tr>
    </table>
    <table class='ninept cframe' width=100%><tr><td>
     <error_lines>
     <batcher list='$;'>
     <ifnzero what='$;Count'>
      <for>
       <post posting='$.'>
      </for>
      <batcher list='$;'>
     </ifnzero>
    </td></tr></table>
   </td>
  </tr>
 </table>
 <bottom>
</body>
</html>
