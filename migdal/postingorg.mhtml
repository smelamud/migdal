<< @(#) $Id$ >>

<grps>
<int name='topic_id'>
<int name='offset'>
<int name='recursive'>
<assign name='recursive' value!='$recursive>=0 ? 1 : 0'>
<int name='grp'>
<assign name='grp' value!='$grp>0 ? $grp : ($grp==0 ? *GRP_TAPE : 0)'>

<element name='batcher' params='list'>
<table width=100%><tr valign=bottom>
 <td align=center><spin list='$list'></td>
</tr></table>
</element>

<element name='error_lines'>
<if what='$$err!=0'>
 <table>
  <error id='*EMH_NO_MESSAGE' text='Такого сообщения не существует'>
  <error id='*EMH_NO_MODERATE' text='Вы не модератор'>
  <error id='*EMR_NO_RENEW' text='Вы не модератор'>
  <error id='*EMR_NO_MESSAGE' text='Такого сообщения не существует'>
  <error id='*EMR_SQL' text='Ошибка базы данных при обновлении записи'>
  <error id='*EPD_NO_DELETE' text='Вы не модератор'>
  <error id='*EPD_POSTING_ABSENT' text='Такого сообщения не существует'>
 </table>
</if>
</element>

<element name='post' params='posting'>
<table class='posting' width=100%>
 <tr><td>
  <iterate_topic_hierarchy topic_id='$posting.TopicId' root='$`links`'>
  <span class='subject'>
   <a href='$[topic_id=$posting.TopicId]' title='$posting.TopicDescription'
      class='topic'><asp>
    <for>
     <if what='!$;isFirst'>&sp;::&sp;</if>
     $.Name
    </for>
   <asp></a>
  </span>
  // $posting.GrpTitle
 </td></tr>
 <tr><td>
  <a href='$posting.DetailsFile?$posting.DetailsId=$posting.Id&redirid=$_'>
   $posting.SubjectDesc</a>
  <ifne what='$posting.Ident'>
   [$posting.Ident=$posting.Id]
  <else>
   [$posting.Id]
  </ifne>
 </td></tr>
 <ifnzero what='$posting.VoteCount'>
  <tr><td>
   $posting.VoteString&nbsp;<image src#='pics/bar-${posting.Vote20}.gif'>
   &nbsp;
   <array vals='голос,голоса,голосов'>
   <plural value='$posting.VoteCount'>
   ($posting.VoteCount&sp;$,)
  </td></tr>
 </ifnzero>
 <tr><td class='sent'>
  <sentview date='$posting.Sent'>&nbsp;
  <senderlink message='$posting'>
 </td></tr>
 <tr><td class='bottom'>
  <a href="postingedit.php?editid=$posting.Id&grp=*GRP_ALL&root=-1&full=1&redirid=$_"
     >Изменить</a>
  &nbsp;
  <if what='$posting.isDisabled'>
   <a href="actions/moderate.php?editid=$posting.MessageId&hide=0&okdir=$#-&faildir=$#-"
      >Разрешить&nbsp;показ</a>
  <else>
   <a href="actions/moderate.php?editid=$posting.MessageId&hide=1&okdir=$#-&faildir=$#-"
      >Запретить&nbsp;показ</a>
  </if>
  &nbsp;
  <a href='actions/shadow.php?postid=$posting.Id&okdir=$#-&faildir=$#-'
     >Тень<ifnzero what='$posting.Shadow'> (*)</ifnzero></a>
  &nbsp;
  <a href="actions/messagerenew.php?id=$posting.MessageId&okdir=$#-&faildir=$#-"
     >Осовременить</a>
  &nbsp;
  <a href="actions/postingdel.php?id=$posting.Id&okdir=$#-&faildir=$#-"
     >Удалить</a>
 </td></tr>
</table>
<p>
</element>

<pagetitle title='Организатор сообщений'>

<html>
<preamble>
<body>
 <top ident='index'>
 <table class='ninept aframe' style='padding: 5px'>
  <form method=post action='actions/postingorg-goto.php'>
   <tr><td colspan=2>
    <a href='topicorg.php?redirid=$_'>Организатор тем</a>
   </td></tr>
   <tr valign=top>
    <td><table>
     <hidden name='okdir' value='$-'>
     <hidden name='faildir' value='$-'>
     <hidden name='redirid' value='$redirid'>
     <topicselect name='topic_id' value='$topic_id'>
     <tr><td>&nbsp;</td><td>
      <checkbox title='С подтемами' name='recursive' value='$recursive'>
     </td></tr>
     <formbuttons title='Просмотр' span=2>
    </table></td>
    <td>
     <select name='grp[]' size=6 multiple>
      <iterate_grps>
      <for>
       <if what='$.isValid'>
	<radio title='$.GrpTitle' value='$.Grp' peervalue!='$grp & $.Grp'>
       </if>
      </for>
     </select>
    </td>
   </tr>
  </form>
 </table>
 <table class='ninept cframe' width=100%><tr><td>
  <error_lines>
  <iterate_postinglist topic='$topic_id' limit=20 offset='$offset'
		       showshadows='*true' grp='$grp' recursive='$recursive'>
  <batcher list='$;'>
  <ifnzero what='$;Count'>
   <for>
    <post posting='$.'>
   </for>
   <batcher list='$;'>
  </ifnzero>
 </td></tr></table>
 <bottom>
</body>
</html>
