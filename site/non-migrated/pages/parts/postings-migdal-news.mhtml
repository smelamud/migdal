<< @(#) $Id$ >>

<grps>

<element name='batcher' params='&list,topic_id,access'>
<div class='batcher'>
 <div class='adder'>
  <image src='/pics/sheet.gif'>&sp;
  <catalog name='catalog' id='$topic_id'>
  <if what='$topic_id>0'>
   <entry_grps name='grps' id='$topic_id'>
  <else>
   <grp_array name='grps' grp='*GRP_ALL'>
  </if>
  <a href='/${catalog}add-news?noguests=$access&redirid=$_'
     >Добавить новость</a><asp>
  <if what='in_array(*GRP_ARTICLES,$grps)'>
   <asp>,
   <a href='/${catalog}add-article?noguests=$access&redirid=$_'
      >статью</a><asp>
  </if>
  <if what='in_array(*GRP_GALLERY,$grps)'>
   <asp>,
   <a href='/${catalog}add-picture?noguests=$access&redirid=$_'
      >фотографию</a><asp>
  </if>
  <if what='$$userModerator && in_array(*GRP_BOOKS,$grps)'>
   <asp>,
   <a href='/${catalog}add-book?noguests=$access&redirid=$_'
      >книгу</a>
  </if>
 </div>
 <spin list='$list'>
 <div class='clear-floats'></div>
</div>
</element>

<element name='postings_migdal_news'>
<perms id='$topic_id'>
<assign name='access' value='$,isPostable'>
<if what='$topic_id==$`migdal`'>
 <array name='topic_ids' val1='$topic_id' val2='$`migdal.events`'>
 <array name='recursive' val1='*true' val2='*true'>
<else>
 <array name='topic_ids' val1='$topic_id'>
 <array name='recursive' val1='*false'>
</if>
<grp_join name='grp' grp1='*GRP_TAPE' grp2='*GRP_TIMES_ARTICLES'>
<iterate_postinglist topic_id='$topic_ids' recursive='$recursive' grp='$grp'
                     limit=10 offset='$offset'>
<batcher list='$;' topic_id='$topic_id' access='$access'>
<for>
 <posting posting='$.' showtopic!='$topic_id==$`migdal`' shorten='*true'
          showdiscuss='*true'>
</for>
<ifnzero what='$;Count'>
 <batcher list='$;' topic_id='$topic_id' access='$access'>
</ifnzero>
</element>
