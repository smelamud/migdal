<< @(#) $Id$ >>

<int name='postid'>
<int name='editid'>

<int name='edittag'>
<int name='small_image'>
<int name='small_image_x'>
<int name='small_image_y'>
<string name='small_image_format'>
<int name='large_image'>
<int name='large_image_x'>
<int name='large_image_y'>
<int name='large_image_size'>
<string name='large_image_format'>
<string name='large_image_filename'>
<string name='title'>
<int name='no_resize'>

<html>
 <preamble>

 <top ident='index'>
 <posting_obj id='$postid'>
 <table width=100%><tr valign=top>
  <td class='eframe' width=200>
   <iterate_images postid='$,Id'>
   <topics_table class='ninept' title='Иллюстрации'>
    <topics_line arrow!='$editid==0' href='$[err edittag editid=0]'
                 class='new' text='-- Добавить --'>
    <for>
     <ife what='$.Title'>
      <assign name='name' value='$.LargeImageFilename'>
     <else>
      <assign name='name' value='$.TitlePea'>
      <if what='!$.isTitlePea'>
       <assign name='name' value#='$name...'>
      </if>
     </if>
     <if what='$.isInserted'>
      <assign name='name' value#='(+) $name'>
     </if>
     <topics_line arrow!='$editid==$.Id' href='$[err edittag editid=$.Id]'
		  text='$name'>
     <li class='topics-comment'>
      <if what='$.hasLargeImage'>
       (${.SmallImageX}x${.SmallImageY})
      </if>
      ${.ImageX}x${.ImageY}, ${.LargeImageSizeKB}KB
      <br><a href='/actions/posting/image/delete?editid=$.Id&okdir=$#-&faildir=$#-'
             class='edit'>Удалить</a>
     </li>
    </for>
   </topics_table>
  </td>
  <td>
   <form_table title#='Иллюстрации к статье "$=,Subject"'>
    <image_obj id='$editid'>
    <setup>
    <form method=post enctype='multipart/form-data'
	  action='/actions/posting/image/modify'>
     <hidden name='edittag' value=1>
     <hidden name='okdir' value='$-'>
     <hidden name='faildir' value='$-'>
     <hidden name='postid' value='$postid'>
     <hidden name='editid' value='$editid'>
     <starinfo>
     <error id='*ELIM_NO_EDIT' text='Вы не можете редактировать эту картинку'>
     <error id='*ELIM_NO_POSTING' text='Вышестоящего сообщения не существует'>
     <error id='*ELIM_POSTING_APPEND' text='Вы не можете редактировать этот список'>
     <error id='*ELIM_IMAGE_ABSENT' text='Картинка не указана'>
     <error id='*EIU_UNKNOWN_IMAGE' text='Неизвестный формат картинки'>
     <error id='*EIU_IMAGE_LARGE' text='Картинка слишком велика (больше 2M)'>
     <error id='*EIU_UNKNOWN_THUMBNAIL'
	    text='Формат маленькой картинки, указанный при конфигурации сервера,
		  не поддерживается'>
     <error id='*EIU_INTERNAL_ERROR' text='Не удалось загрузить картинку'>
     <error id='*EVH_NO_PARENT' text='Такой темы не существует'>
     <error id='*EVH_NO_UP' text='Вышестоящего сообщения не существует'>
     <error id='*EVH_LOOP' text='Сообщение не может быть подчиненным себе'>
     <error id='*EVH_NOT_UP_UNDER_PARENT'
	    text='Тема вышестоящего сообщения должна совпадать с этой темой'>
     <error id='*EVH_INCORRECT' text='Нарушение иерархии объектов'>
     <if what='$,hasSmallImage'>
      <assign name='loaded' value#='Загружен файл $=,LargeImageFilename
				    (${,LargeImageSizeKB}K)'>
     <else>
      <assign name='loaded' value=''>
     </if>
     <assign name='small_url' value!="$,hasLargeImage ? $,SmallImageURL : ''">
     <assign name='large_url' value="$,LargeImageURL">
     <form_uploader title='Изображение' name='image_file'
                    loaded='$loaded' delname='del_image'
		    small_url='$small_url' large_url='$large_url'
		    mandatory='*true'>
     <form_checkbox title='Вставлять в уменьшенном виде' name='has_large_image'
                    checked='$,hasLargeImage' style='radio' id_yes='hlm-yes'>
     <form_line title='Размер'>
      <edit name='small_image_x' value='$,SmallImageX' size=4 maxlength=4
            onkeypress='$("#hlm-yes").attr("checked", true)'>
      x
      <edit name='small_image_y' value='$,SmallImageY' size=4 maxlength=4
            onkeypress='$("#hlm-yes").attr("checked", true)'>
     </form_line>
     <hidden name='small_image' value='$,SmallImage'>
     <hidden name='small_image_format' value='$,SmallImageFormat'>
     <hidden name='large_image' value='$,LargeImage'>
     <hidden name='large_image_x' value='$,LargeImageX'>
     <hidden name='large_image_y' value='$,LargeImageY'>
     <hidden name='large_image_size' value='$,LargeImageSize'>
     <hidden name='large_image_format' value='$,LargeImageFormat'>
     <hidden name='large_image_filename' value='$,LargeImageFilename'>
     <form_editor title='Подпись' name='title' body='$=,Title' rows=3>
     <form_checkbox title='Загружать в высоком разрешении'
                    comment='Использовать только в исключительных случаях'
                    name='no_resize' style='box' checked!='$no_resize!=0'>
     <if what='$editid'>
      <form_buttons title='Изменить'>
     <else>
      <form_buttons title='Добавить'>
     </if>
    </form>
   </form_table>
  </td>
 </tr></table>
 <bottom>
</html>
