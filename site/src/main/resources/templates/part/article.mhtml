<< @(#) $Id$ >>

<element name='article_editmode'>
<?php
if(!isset($editmodeHistory))
  $editmodeHistory=array();
?>
<array_push array='$$editmodeHistory' value='$editing'>
<assign_global name='editmode' value='$editing'>
</element>

<element name='/article_editmode'>
<array_pop array='$$editmodeHistory'>
<assign_global name='editmode' value='$,'>
</element>

<callback name='article_image'>
<assign name='image' value='$data.Image'>
<assign name='has_image' value!='$image instanceof Entry'>
<if what='$has_image'>
 <if what='$$editmode'>
  <posting_obj id='$data.Id'>
  <assign name='edithref'
          value#='${,GrpDetailsHref}images/insert/?par=$data.Par&editid=$image.Id'>
  <assign name='rmhref'
          value#='/actions/posting/image/modify?edittag=1&insert=1&postid=$data.Id&editid=0&par=$data.Par&okdir=$#-&faildir=$#-'>
 <else>
  <assign name='edithref' value=''>
  <assign name='rmhref' value=''>
 </if>
 <posting_og_image posting='$image'>
 <posting_image posting='$image' title='$image.TitleHTML'
                title_large='$image.TitleLineHTML' rel#='article-$data.Id'
                edithref='$edithref' rmhref='$rmhref' align='$data.Align'>
<else>
 <if what='$$editmode'>
  <ifne what='$data.Align'>
   <assign name='align' value#='style="float: $data.Align; clear: $data.Align"'>
  <else>
   <assign name='align' value=''>
  </ifne>
  <posting_obj id='$data.Id'>
  <notenglish>
   <assign name='ititle' value='Вставить картинку'>
  <else>
   <assign name='ititle' value='Insert a Picture'>
  </notenglish>
  <div class='insert-image' $align><span>
   <a href='${,GrpDetailsHref}images/insert/?par=$data.Par'
      class='eightpt'>$ititle</a>
  </span></div>
 </if>
</if>
</callback>

<element name='article_controls'>
<notprint>
 <outer>
  <div class='controls-line'><div class='controls'><inner>
   <printlink posting='$posting'>
   <iswrite what='$posting'>
    &nbsp;&nbsp;
    <editlink posting='$posting'>
    &nbsp;&nbsp;
    <a href="${posting.GrpDetailsHref}images/">
     <notenglish>Список иллюстраций<else>List of pictures</notenglish></a>
   </iswrite>
   <if what='!$nodiscuss'>
    &nbsp;&nbsp;
    <discusslink posting='$posting'>
   </if>
  </inner></div></div>
 </outer>
</notprint>
</element>

<element name='article'>
<assign name='note_base'
        value!="$note_base_var!='' ? $GLOBALS[$note_base_var] : 1">
<article_editmode editing!='$posting.isWritable'>
 <assign name='text' value='$posting.LargeBodyHTML'>
 $text.TextHTML
</article_editmode>
<ifne what='$posting.Source'>
 <p class='source'>Источник: $posting.SourceHTML</p>
</ifne>
<div class='clear-floats'></div>
<if what='$withvote'>
 <vote_panel id='$posting.Id' rating='$posting.Rating'>
</if>
<ifne what='$text.FootnotesHTML'>
 <hr class='notes' align=left>
 $text.FootnotesHTML
</ifne>
<<ifne what='$note_base_var'>
 <?php $GLOBALS[$note_base_var]=$list->getNoteOffset(); ?>
</ifne>>
</element>

<element name='article_full'>
<blockquote class='preface'>
 $posting.BodyHTML
</blockquote>
<article posting='$posting'>
</element>
